<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Plans API](#plans-api)
  - [Common provisions](#common-provisions)
      - [Terminology](#terminology)
      - [Protocol](#protocol)
      - [Encoding](#encoding)
      - [Authentication](#authentication)
      - [General responses](#general-responses)
  - [Schema](#schema)
    - [Simple](#simple)
  - [Endpoints](#endpoints)
    - [Daily Readiness](#daily-readiness)
      - [Create](#create)
      - [Soreness/Typical Session history](#sorenesstypical-session-history)
    - [Session](#session)
      - [Create](#create-1)
      - [Mark no sessions planned](#mark-no-sessions-planned)
      - [Delete](#delete)
      - [Update](#update)
      - [Typical Sessions history](#typical-sessions-history)
    - [Symptoms](#symptoms)
      - [Submit](#submit)
    - [Active Recovery](#active-recovery)
      - [Mark Started (Exercise Modalities)](#mark-started-exercise-modalities)
      - [Mark Completed (Exercise Modalities)](#mark-completed-exercise-modalities)
      - [Mark Started (Body Part Modalities)](#mark-started-body-part-modalities)
      - [Mark Completed (Body Part Modalities)](#mark-completed-body-part-modalities)
    - [Daily Plans](#daily-plans)
      - [Get daily plan](#get-daily-plan)
    - [Coach Dashboard](#coach-dashboard)
      - [Get dashboard data for all users](#get-dashboard-data-for-all-users)
    - [Athlete](#athlete)
      - [Athlete Survey](#athlete-survey)
    - [Health Data](#health-data)
      - [Sync health data](#sync-health-data)
    - [Misc](#misc)
      - [Clear user's data](#clear-users-data)
      - [Log App/Device information](#log-appdevice-information)
      - [Copy test user's data](#copy-test-users-data)
  - [Appendix](#appendix)
    - [Enumerations](#enumerations)
      - [Reportable body part](#reportable-body-part)
      - [All body parts](#all-body-parts)
      - [side](#side)
      - [sport name](#sport-name)
      - [Session Source](#session-source)
    - [Body Part Types](#body-part-types)
      - [Joints](#joints)
      - [Ligaments](#ligaments)
      - [Muscles](#muscles)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Plans API

## Common provisions

#### Terminology

The terminology of [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt) (specifically __must__, __should__, __may__ and their negatives) applies.  The word __will__, when applied to the Plans API ("the API"), has the same meaning as __must__.

#### Protocol

The API supports communication over HTTPS only.  Requests sent via HTTP will be redirected to HTTPS connections.

#### Encoding

The API supports communication using JSON encoding only.  The client __must__ submit the headers `Content-Type: application/json` and `Accept: application/json` for all requests.  Failure to do so __will__ result in a `415 Unsupported Media Type` response.  The API __will__ include the header `Content-Type: application/json` with its response.

#### Authentication

Unless otherwise specified, the endpoints in the API are authenticated by a JWT bearer token.  One token source is accepted:

* Tokens generated by Amazon Cognito and acquired as part of authentication to the Users Service;

The client __must__ submit the header `Authorization: <JWT>` with all requests. Failure to do so, or submitting an invalid or expired JWT, __will__ result in a `401 Unauthorized` response.  

#### General responses

In addition to the AWS API Gateway responses and the specific responses for each endpoint, the server __may__ respond with one of the following HTTP responses:

* `400 Bad Request` with `Status` header equal to `InvalidSchema`, if the JSON body of the request does not match the requirements of the endpoint.
* `403 Forbidden` with `Status` header equal to `Forbidden`, if the user is not allowed to perform the requested action.
* `404 Unknown` with `Status` header equal to `UnknownEndpoint`, if an invalid endpoint was requested.

## Schema

### Simple

The following simple types __may__ be used in responses:

* `string`, `number`, `integer`, `boolean`: as defined in the [JSON Schema](http://json-schema.org) standard.
* `Uuid`: a `string` matching the regular expression `^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$`, that is, the string representation of an [RFC 4122](https://tools.ietf.org/html/rfc4122) UUID.
* `Datetime`: a `string` matching the regular expression `/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|+\d{2}:\d{2})/` and representing a date and time in full [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

## Endpoints

### Daily Readiness

#### Create

This endpoint can be called to register a new daily readiness survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/daily_readiness/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "date_time": Datetime,
    "soreness": [sore_part, sore_part],
    "clear_candidates": [sore_part, sore_part],
    "sessions": [session, session],
    "sessions_planned": boolean,
    "health_sync_date": Datetime,
    "user_age": number,
    "sleep_data": [sleep_event]
}
```
* `date_time` __should__  be a Datetime and reflect the local time that survey was taken
* `soreness` __should__ reflect a list of body parts(`sore_part`) with symptoms. Length __could__ be 0.
* `clear_candidates` is __optional__ and __should__ include body parts that were candidates to be cleared of historical status. Note this should include the body part even if marked "all_clear"
* `sessions` is __optional__ and __should__ be a list of session objects, where each session matches the body of [Create](#create-2) Session.
* `sessions_planned` __should__ be a boolean representing whether the user plans to train again that day.
* `health_sync_date` is __optional__ and only provided if one of the sessions is obtained from health app
* `user_age` is __optional__ and only needed if one of the sessions is obtained from health app and contains heart rate data
* `sore_part` __should__ have the following schema:
```
{
    "body_part": number,
    "side": number,
    "tight": number,
    "knots": number,
    "ache": number,
    "sharp": number
}

```
* `body_part` __should__ be an integer reflecting [BodyPart](#reportable-body-part) enumeration
<!-- * `severity` __should__ be an integer 0, 1, 3 or 5 indicating the severity of the pain/soreness -->
<!-- * `movement` __should__ be an integer 0, 1, 3 or 5 indicating how much movement is restricted  -->
* `side` __should__ be an integer, either 0 (both sides/non-bilateral), 1 (left) or 2 (right)
* `tight` __should__ be an integer (1-10) indicating the severity of tightness felt. If not reported, it should be `null`
* `knots` __should__ be reported for [muscles](#muscles) only and __should__ be an integer (1-10) indicating the severity of discomfort caused by knots, tigger points, and musclular adhesions felt. If not reported, it should be `null`
* `ache` __should__ be an integer (1-10) indicating the severity of discomfort felt described as an ache, dull, or sore, indicating inflammation and muscle spasms are likely present. If not reported, it should be `null`
* `sharp` __should__ be an integer (1-10) indicating the severity of discomfort felt described as sharp, acute, shooting, indicating that inflammation and muscle spasms are likely present. If not reported, it should be `null`
<!-- * `pain` __should__ be a boolean to indicate whether it's pain or soreness. -->
<!-- * `status` __should__ be a string representing the historical soreness status if one was received. Optional for soreness but required for clear candidates. -->

```
POST /plans/version/daily_readiness/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "date_time": "2018-12-10T17:45:24Z",
    "soreness":[{
                                    "body_part": 14,
                                    "side": 2
                                    "tight": null,
                                    "knots": null,
                                    "ache": 3,
                                    "sharp": 6,
                                }],
    "sessions": [{"event_date": "2018-12-10T12:30:00Z",
                  "sport_name": 3,
                  "duration": 90,
                  "description": "Evening Practice",
                  "post_session_survey": {
                                         "event_date": "2018-12-10T17:45:24Z",
                                         "RPE": 9,
                                         "soreness": []
                                        }
                  }
                ],
    "user_age": 25,
    "sessions_planned": false,
    "sleep_data": [{"value": "INBED", "startDate": "2019-01-09T00:09:50.212-0500", "endDate": "2019-01-09T07:35:21.256-0500"}]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).


#### Soreness/Typical Session history

This endpoint can be called to get the body parts where soreness was reported in the last three days and typical sessions.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/daily_readiness/{User UUID}/previous`. The request method __must__ be `POST`.

##### Request
For `POST` method, the client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
```
POST /plans/version/daily_readiness/{User UUID}/previous HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

```
Authentication is required for this endpoint

##### Responses
 
 The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
"readiness": readiness,
"typical_sessions": [sesson, session]
```
* `readiness` will have the following schema
```
{
    "body_parts": [
                {"body_part": number, "side": number, "status": string},
                {"body_part": number, "side": number, "status": string}
                ],
    "hist_sore_status": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "clear_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "dormant_tipping_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "current_position": number,
    "current_sport_name": number,
    "functional_strength_eligible": boolean,
}
```
* `body_part` will be a list of enumerated body parts + side (potentially empty). `DEPRECATED: WILLL ALWAYS BE EMPTY`
* `clear_candidates` will be a list of sore body parts with historical status that are candidates for clearance `DEPRECATED: WILLL ALWAYS BE EMPTY`
* `hist_sore_status` will be a list of sore body parts with historical status that are not candidates for clearing `DEPRECATED: WILLL ALWAYS BE EMPTY`
* `dormant_tipping_candidates` will be a list of sore body parts that should not prompt a response for the user but if they indicate a status for that, they will tip into specific status as defined in the response `DEPRECATED: WILLL ALWAYS BE EMPTY`
* `current_position` and `current_sport_name` will be enumeration `DEPRECATED`
* `current_position` exists but `current_sport_name` does not, then it's implied that the user wants functional strength for sport-less activity `DEPRECATED`

* `typical sessions` will be a list of sessions that the user has logged in the last 14 days. 
* `session` object will be of the following schema

``` 
{
    "count": number,
    "duration": number,
    "event_date": datetime,
    "session_type": number,
    "sport_name": number,
    "strength_and_conditioning_type": number
}

```

### Session

#### Create

This endpoint can be called to log a new session to today's plan and should include the session information as well as post-session surveys for the session being logged.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "sessions": [session, session],
    "health_sync_date": Datetime,
    "sessions_planned": Boolean
    "user_age": number
}
```
* `event_date` __should__ reflect the date and time when the survey is submitted.
* `health_sync_date` is __optional__ and only provided if one of the sessions is obtained from health app
* `sessions_planned` __should__ be a boolean representing whether the user plans to train again that day.
* `user_age` is __optional__ and only needed if one of the sessions is obtained from health app and contains heart rate data
* `session` __should__ be of the following schema
```
{
    "event_date": Datetime,
    "end_date": Datetime,
    "session_type": number,
    "sport_name": number,
    "duration": number,
    "description": string,
    "calories": number,
    "distance": number,
    "source": number,
    "deleted": boolean,
    "ignored": boolean,
    "post_session_survey": {
                            "event_date": Datetime
                            "RPE": number,
                            "soreness": [sore_part, sore_part],
                            "clear_candidates": [sore_part]}
                        },
    "hr_data": [hr, hr, hr]
}
```
* `event_date` __should__ reflect the start time of the session (health/three sensor data) or default date (manually logged session)
* `end_date` is __optional__ parameter that reflects the end time of the session for health/three sensor data
* `session_type` __should__ be an integer reflecting SessionType enumeration. NOTE: We'll only use 6 moving forward
* `sport_name` __should__ be an integer reflecting  [sport name](#sport-name) enumeration.
* `duration` __should__ be in minutes and reflect the duration which the user confirmend (health data) or entered (manually logged session).
* `calories` __if present__, __should__ be calorie information obtained from health workout _(only needed for health workout)_
* `distance` __if present__, __should__ be distance information obtained from health workout _(only needed for health workout)_
* `source` __if present__, __should__ reflect [Session source](#session-source) enumeration
* `deleted` __if present__, __should__ be true if the user deletes the workout detected from health app
* `ignored` __if present__, __should__ be true for short walking workouts.
* `hr_data` __if present__, __should__ be the heart rate data associated with the health workout. each hr will have `startDate`, `endDate` and `value` _(only needed for health workout)_
* `description` is __optional__ parameter to provide short description of the session they're adding

```
POST /plans/version/session/{User UUID} HTTP/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "event_date": "2019-01-12T16:54:57Z",
    "sessions":[
                {
                    "event_date": "2019-01-12T10:41:57Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 14,
                    "description": "Evening Practice",
                    "calories": 100,
                    "distance": 200,
                    "end_date": "2019-02-12T10:54:57Z",
                    "source": 1,
                    "deleted": false,
                    "ignored": false,
                    "hr_data":  [
                                {"value": 153, "startDate": "2019-01-12T10:43:08.490-0500", "endDate": "2019-01-12T10:43:08.490-0500"},
                                {"value": 156, "startDate": "2019-01-12T10:43:03.490-0500", "endDate": "2019-01-12T10:43:03.490-0500"},
                                {"value": 161, "startDate": "2019-01-12T10:42:58.490-0500", "endDate": "2019-01-12T10:42:58.490-0500"},
                                {"value": 163, "startDate": "2019-01-12T10:42:56.490-0500", "endDate": "2019-01-12T10:42:56.490-0500"},
                                {"value": 167, "startDate": "2019-01-12T10:42:50.490-0500", "endDate": "2019-01-12T10:42:50.490-0500"},
                                {"value": 163, "startDate": "2019-01-12T10:42:47.490-0500", "endDate": "2019-01-12T10:42:47.490-0500"},
                                {"value": 127, "startDate": "2019-01-12T10:41:23.490-0500", "endDate": "2019-01-12T10:41:23.490-0500"}
                            ],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:54:57Z",
                                            "RPE": 5,
                                            "soreness": [],
                                            "clear_candidates": []
                                            }
                    }
                    
                ],
    "user_age": 25,
    "sessions_planned": true,
    "health_sync_date": "2019-02-08T16:54:57Z"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).


#### Mark no sessions planned

This endpoint can be called to notify that no sessions are planned for the day.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{{User UUID}/no_session`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/version/session/{User UUID}/no_session HTTP/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "event_date": "2018-09-14T19:54:48Z"

}
```
##### Responses
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plan": daily_plan
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).

#### Delete

This endpoint can be called to delete existing externally regimented session from today or yesterday's plan.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{session_id}`. The request method __must__ be `DELETE`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "session_type": number
}
```
* `event_date` __should__ reflect the date and time the session was scheduled for.
* `session_type` __should__ be an integer reflecting SessionType enumeration.

```
DELETE /plans/version/session/{User UUID}/{Session ID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-10T16:30:00Z",
    "session_type": 0
}
```
##### Responses
 
 If the delete was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Update

This endpoint can be called to update and combine manually logged session with a health app session

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{User UUID}/{session_id}`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "sessions": [session],
    "health_sync_date": Datetime
}
```
* `event_date` __should__ reflect the local date and time when the call is being made
* `session` __should__ follow the same schema as defined in [Create Session](#create-2)
* `health_sync_date` __should__ reflect the time when the data was obtained from health app

```
PATCH /plans/version/session/{User UUID}/{Session ID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-02-08T16:30:00Z",
    "sessions": [
                 {
                    "event_date": "2019-02-08T16:45:55Z",
                    "end_date": "2019-02-08T16:45:55Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 90.5,
                    "calories": 50,
                    "distance": 100,
                    "source": 1,
                    "hr_data": [],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:30:00Z",
                                            "RPE": null,
                                            "soreness": [],
                                            "clear_candidates": []
                                            }

                }
                ],
    "health_sync_date": "2019-02-08T16:30:00Z"
}
```
##### Responses
 
 If the update was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


#### Typical Sessions history

This endpoint can be called to get typical sessions that the user logs

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}/typical`. The request method __must__ be `POST`.

##### Request
For `POST` method, the client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
```
POST /plans/{version}/session/{User UUID}/typical HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-02-08T16:30:00Z"
}

```
Authentication is required for this endpoint

##### Response
 
 The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "typical_sessions": [sesson, session]
}
```
`typical sessions` will be a list of sessions that the user has logged in the last 14 days. 
* `session` object will be of the following schema

``` 
{
    "count": integer,
    "duration": integer,
    "event_date": datetime,
    "session_type": integer,
    "sport_name": integer,
    "strength_and_conditioning_type": integer
}

```

### Symptoms

#### Submit

This endpoint can be called to submit symptoms to receive a new plan without submitting a session.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/symptoms/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "soreness": [sore_part, sore_part]
}
```
* `event_date` __should__  be a Datetime and reflect the local time that survey was taken
* `soreness` __should__ reflect a list of body parts(`sore_part`) as defined in Readiness [Create](#create)


```
POST /plans/version/symptoms/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-10-29T17:45:24Z",
    "soreness":[
        {
            "body_part": 18,
            "side": 0,
            "tight": 4,
            "knots": null,
            "sharp": null,
            "ache": null
        }
    ]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).


### Active Recovery

#### Mark Started (Exercise Modalities)

This endpoint can be called to mark the start of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/{User UUID}/exercise_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the first exercise for the session.
* `recovery_type` __should__ be one of `pre_active_rest`, `post_active_rest` or `cool_down`

```
POST /plans/version/active_recovery/{User UUID}/exercise_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "pre_active_rest"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Exercise Modalities)

This endpoint can be called to mark the completion of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/{User UUID}/exercise_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be one of `pre_active_rest`, `post_active_rest` or `cool_down`
* `completed_exercises` __should__ be a list representing the exercises that the user checked off

```
PATCH /plans/version/active_recovery/{User UUID}/exercise_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "post_active_rest",
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).



#### Mark Started (Body Part Modalities)

This endpoint can be called to mark the start of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/{User UUID}/body_part_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the starts the session
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`

```
POST /plans/version/active_recovery/{User UUID}/body_part_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "heat"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Body Part Modalities)

This endpoint can be called to mark the completion of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/{User UUID}/body_part_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
    "completed_body_parts": [body_part]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`
* `completed_body_parts` __should__ be a list representing the body parts that the user selected from the provided list. It should be empty for `cold_water_immersion`.
* `body_part` __should__ be of the following schema
```
{
    "body_part_location": number,
    "side": number
}
```
* `body_part_location` __should__ be an integer reflecting [BodyPart](#reportable-body-part) enumeration
* `side` __should__ be an integer reflecting [side](#side) enumeration

```
PATCH /plans/version/active_recovery/{User UUID}/body_part_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "ice",
    "completed_body_parts": [
                                {
                                    "body_part_lcoation": 3,
                                    "side": 0,
                                },
                                {
                                    "body_part_lcoation": 7,
                                    "side": 1,
                                }
                        ]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in [Get daily plan](#get-daily-plan).


### Daily Plans

#### Get daily plan

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/daily_plan/{User UUID}`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
    "start_date": string,
    "end_date": string
}
```
* `event_date` __should__ reflect the time (in local timezone) when the api call is made.
* `start_date` __should__ should be of format `yyyy-mm-dd`
* `end_date` __should__ should be of format `yyyy-mm-dd` but is __optional__

```
POST /plans/version/daily_plan/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-07-31T02:50:02Z",
    "start_date": "2018-07-31"
}
```
##### Responses
 
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan1, daily_plan2],
    "readiness": readiness,
    "typical_sessions": [session, session]
}
```
* `readiness` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined in [here](#sorenesstypical-session-history)
* `typical_sessions` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined [here](#sorenesstypical-session-history)
* `daily_plans` __could__ be empty list
* each `daily_plan*` will be of following schema:
```
{
    "date": Date,
    "day_of_week": Number,
    "pre_active_rest": [PreActiveRest],
    "completed_pre_active_rest": [PreActiveRest],
    "heat": Heat,
    "completed_heat": [Heat],
    "warm_up": [WarmUp],
    "completed_warm_up": [WarmUp],
    "training_sessions": [Session],
    "cool_down": [CoolDown],
    "completed_cool_down": [CoolDown],
    "post_active_rest": [PostActiveRest],
    "completed_post_active_rest": [PostActiveRest],
    "ice": Ice,
    "completed_ice": [Ice],
    "cold_water_immersion": ColdWaterImmersion,
    "completed_cold_water_immersion": [ColdWaterImmersion],
    "cross_training_sessions": [],
    "daily_readiness_survey_completed": Boolean,
    "landing_screen": Number,
    "last_sensor_sync": Datetime,
    "last_updated": Datetime,
    "nav_bar_indicator": null,
    "post_active_rest_completed": Boolean,
    "pre_active_rest_completed": Boolean,
    "sessions_planned": Boolean,
    "train_later": Bolean
}
```
* Any of the `completed_*` attributes could be empty list
* Any of the exercise modalities (`pre_active_rest`, `post_active_rest`, `warm_up` and `cool_down`) could be empty list
* Any of the body part modalities (`heat`, `ice`, `cold_water_immersion`) could be null
* `Heat` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "before_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
```
* `Ice` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "after_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "immediately_after_training": false,
            "repeat_every_3hrs_for_24hrs": false,
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
```
* `ColdWaterImmersion` has following example schema
```
{
    "minutes": 10,
    "after_training"': true,
    "goals": [
        {
            "goal_type": 0,
            "priority": 1,
            "text": "Care for Pain",
            "trigger": "Pain Reported Today"
        }
    ],
    "start_date_time": null,
    "completed_date_time": null,
    "event_date_time": null,
    "completed": false,
    "active": true
}

```
* `PretActiveRest` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "active_stretch_exercises": [AssignedExercise, AssignedExercise]
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
    "muscular_strain_increasing": false,
    "start_date_time": null,
}
```
* `PostActiveRest` has following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "muscular_strain_increasing": false,
    "start_date_time": null,
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
}
```
* `CoolDown` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "dynamic_integrate_exercises": [AssignedExercise, AssignedExercise],
    "dynamic_stretch_exercises": [AssignedExercise, AssignedExercise],
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "muscular_strain_increasing": false,
    "sport_name": 17,
    "start_date_time": null
    }
```

* `AssignedExercise` has the following example schema
```
{
    "bilateral": true,
    "description": "Step forward and straighten your leg, lifting your toes off the ground as you lean down, moving your arms in a scooping motion. Straighten back up and repeat on the other leg as you take another step forward. ",
    "display_name": "Walking Hamstring Scoops",
    "dosages": [
        {
            "complete_reps_assigned": 12,
            "complete_sets_assigned": 1,
            "comprehensive_reps_assigned": 12,
            "comprehensive_sets_assigned": 1,
            "efficient_reps_assigned": 12,
            "efficient_sets_assigned": 1,
            "goal": {
                "goal_type": 2,
                "priority": 1,
                "text": "Recover from Sport",
                "trigger": "High Relative Volume or Intensity of Logged Session"
            },
            "priority": "1",
            "ranking": 0,
            "soreness_source": {
                "body_part": 13,
                "first_reported_date_time": null,
                "movement": null,
                "pain": false,
                "severity": 0.4,
                "side": null
            }
        }
    ],
    "duration_complete": null,
    "duration_comprehensive": null,
    "duration_efficient": null,
    "equipment_required": [
        "None"
    ],
    "goal_text": "",
    "library_id": "139",
    "name": "Walking Hamstring Scoops",
    "position_order": 0,
    "seconds_per_rep": null,
    "seconds_per_set": 30,
    "unit_of_measure": "yards",
    "youtube_id": null
}
```

### Coach Dashboard

#### Get dashboard data for all users
This endpoint can used get relevant data for all the users across all the team the user is a coach for. Note that the user needs to be a coach for all the teams they belong to.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/coach/{user_id}/dashboard`. The request method __must__ be `GET`.

##### Request
A body is not required for this request

```
GET /plans/version/coach/{user_id}/dashboard HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
```
##### Responses
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{"teams": [team, team]}
```
where team has the following schema
```
{
    "name": string,
    "compliance": compliance,
    "daily_insights": daily_insights,
    "weekly_insights": weekly_insights,
    "athletes": [athlete, athlete]
}
```
* `compliance` would be of format
```
{
    "completed": [user, user],
    "incomplete": [user, user],
    "training_compliance": training_compliance
}
```
* `training_compliance` will have the following schema
```
{
  "no_response": [user, user, user],
  "rest_day": [user, user],
  "sessions_logged": [user, user]
}
```
where `user` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string
}
```
* `daily_insights` will have the following schema
```
{
    "all_good": [user],
    "balance_overtraining_risk": [user, user],
    "add_variety_to_training_risk": [user, user, user],
    "increase_weekly_workload": [user, user, user],
    "address_pain_or_soreness": [user, user, user],
    "evaluate_health_status": [user, user, user]
}
```

* `weekly_insights` will have the following schema
```
{
    "all_good": [user],
    "increase_workload": [user, user],
    "limit_time_intensity_of_training": [user, user, user],
    "monitor_in_training": [user, user, user],
    "not_cleared_for_training": [user, user, user]
}
```
where `user` in `daily_insights` and `weekly_insights`has the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number
}
```
* `athlete` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number,
    "daily_recommendation": [string, string],
    "weekly_recommendation": [string, string],
    "insights': [string, string]
}
```

### Athlete

#### Athlete Survey
This endpoint can used to submit user survey.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/athlete/{athlete_id}/survey`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "wearable_devices": [string, string],
    "typical_weekly_sessions": string
}
```

```
POST /plans/version/athlete/02cb7965-7921-493a-80d4-6b278c928fad/survey HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "wearable_devices": ["Fitbit", "Garmin", "Whoop"],
    "typical_weekly_sessions": "1-3"
}
```
##### Responses
 If successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Health Data

#### Sync health data
This endpoint can used to submit health app workouts from missed days

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/health_data/{User UUID}`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "start_date": Date,
    "end_date": Date,
    "sessions": [session, session],
    "sleep_data": [sleep_event, sleep_event],
}
```
* `event_date` __should__ reflect the local time the call is made
* `start_date` __should__ reflect the start date of the range of data being sent
* `end_date` __should__ reflect the end date of the range of data being sent
* `session` __should__ follow the same schema as defined in [Session Create](#create-2)
* `sleep_event` __should__ follow the same schema as defined in [Readiness Create](#create)

```
POST /plans/version/health_data/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-01-31T16:12:02Z",
    "start_date": "2019-01-29",
    "end_date": "2019-01-30",
    "sessions": [session1],
    "sleep_data": [sleep_event1, sleep_event2]
}
```
##### Responses
 If successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

### Misc

#### Clear user's data
This endpoint can used to clear the user's data for the given day. Note that his endpoint is restricted to select demo accounts and user must be authorized to perform the action. It will clear out users daily readiness survey and their plan for the day. If the request is made before 3 am, plan and surveys for the previous day will be cleared which is consistent with 3am being the cutoff time for the new daily plan.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/{User UUID}/clear_user_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the local date and time when the request was made

```
POST /plans/version/misc/{User UUID}/clear_user_data HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-13T11:12:30Z"
}
```
##### Responses
 If clearing data was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Log App/Device information
This endpoingt can be used to log relevant device/app information and usage

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/{User UUID}/app_logs`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "os_name": string,
    "os_version": string,
    "app_version": string

}
```
* `event_date` __should__ reflect the local date and time when the request was made
* `os_name` __should__ be the os name (Android/iOS)
* `os_version` __should__ be the version of os running on the device
* `app_version` __should__ be the version of app installed


```
POST /plans/version/misc/{User UUID}/app_logs HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-12-13T18:19:50Z",
    "os_name": Android,
    "os_version": "8.1.0",
    "app_version": "2.2.9"
}
```
##### Responses
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Copy test user's data
This endpoint can used to copy test user's data to create personas to test different scenarios. Note that his endpoint is restricted to dev and test environment to specific test accounts.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/{User UUID}/copy_test_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "copy_all": Boolean
}
```
* `event_date` __should__ reflect the local date and time when the request was made
* `cop_all` __should__ be true if trying to copy/reset data for all personas. Setting it false would only copy/reset data for the persona logged in.

```
POST /plans/version/misc/{User UUID}/copy_test_data HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-13T11:12:30Z",
    "copy_all": true
}
```
##### Responses
 If copying data was successful, the Service __will__ respond with HTTP Status `202 Accepted`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

## Appendix

### Enumerations

#### Reportable body part

```
    chest = 2
    abdominals = 3
    groin = 5
    quads = 6
    knee = 7
    shin = 8
    ankle = 9
    foot = 10
    it_band = 11
    lower_back = 12
    glutes = 14
    hamstrings = 15
    calves = 16
    achilles = 17
    upper_back_neck = 18
    elbow = 19
    wrist = 20
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    it_band_lateral_knee = 27
    hip_flexor = 28
    deltoid = 29
```


#### All body parts
```
    shoulder = 1
    chest = 2
    abdominals = 3
    hip = 4
    groin = 5
    quads = 6
    knee = 7
    shin = 8
    ankle = 9
    foot = 10
    it_band = 11
    lower_back = 12
    general = 13
    glutes = 14
    hamstrings = 15
    calves = 16
    achilles = 17
    upper_back_neck = 18
    elbow = 19
    wrist = 20
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    core_stabilizers = 25
    erector_spinae = 26
    it_band_lateral_knee = 27
    hip_flexor = 28
    deltoid = 29
    deep_rotators_hip = 30
    obliques = 31

    # shin
    anterior_tibialis = 40
    peroneals_longus = 41

    # calves
    posterior_tibialis = 42
    soleus = 43
    gastrocnemius_medial = 44

    # hamstrings
    bicep_femoris_long_head = 45
    bicep_femoris_short_head = 46
    semimembranosus = 47
    semitendinosus = 48

    # groin
    adductor_longus = 49
    adductor_magnus_anterior_fibers = 50
    adductor_magnus_posterior_fibers = 51
    adductor_brevis = 52
    gracilis = 53
    pectineus = 54

    # quads
    vastus_lateralis = 55
    vastus_medialis = 56
    vastus_intermedius = 57
    rectus_femoris = 58

    tensor_fascia_latae = 59 # hips
    piriformis = 60 # deep rotator of hip

    gastrocnemius_lateral = 61  # calves - was 75 but that was a duplicate
    sartorius = 62  # quads

    # glutes
    gluteus_medius_anterior_fibers = 63
    gluteus_medius_posterior_fibers = 64
    gluteus_minimus = 65
    gluteus_maximus = 66

    # deep rotators of the hip (30)
    quadratus_femoris = 67

    # knee
    popliteus = 68

    external_obliques = 69  # abdominal

    # lower_back
    quadratus_lumorum = 70

    # hip_flexor
    psoas = 71
    iliacus = 72

    # core_stabilizers
    transverse_abdominis = 73
    internal_obliques = 74

    # abdominals
    rectus_abdominis = 75

    # upper back, traps, neck
    upper_trapezius = 76
    levator_scapulae = 77
    middle_trapezius = 78
    lower_trapezius = 79
    rhomboids = 80

    # chest
    pectoralis_minor = 81
    pectoralis_major = 82

    # deltoid (29)
    anterior_deltoid = 83
    medial_deltoid = 84
    posterior_deltoid = 85

    upper_body = 91
    lower_body = 92
    full_body = 93

    # merge
    semimembranosus_semitendinosus = 100
    anterior_adductors = 101
    rectus_femoris_vastus_intermedius = 102
    glute_med = 103
    upper_traps_levator_scapulae = 105
    middle_traps_rhomboids = 106
    pec_major_minor = 107
    hip_flexor_merge = 108
```

#### side

```
    none_unilateral = 0
    left = 1
    right = 2
```


#### sport name
```
    basketball = 0
    baseball = 1
    softball = 2
    cycling = 3
    field_hockey = 4
    football = 5
    general_fitness = 6
    golf = 7
    gymnastics = 8
    skate_sports = 9
    lacrosse = 10
    rowing = 11
    rugby = 12
    diving = 13
    soccer = 14
    pool_sports = 15
    tennis = 16
    distance_running = 17
    sprints = 18
    jumps = 19
    throws = 20
    volleyball = 21
    wrestling = 22
    weightlifting = 23
    track_field = 24
    archery = 25
    australian_football = 26
    badminton = 27
    bowling = 28
    boxing = 29
    cricket = 30
    curling = 31
    dance = 32
    equestrian_sports = 33
    fencing = 34
    fishing = 35
    handball = 36
    hockey = 37
    martial_arts = 38
    paddle_sports = 39
    racquetball = 40
    sailing = 41
    snow_sports = 42
    squash = 43
    surfing_sports = 44
    swimming = 45
    table_tennis = 46
    water_polo = 47
    cross_country_skiing = 48
    downhill_skiing = 49
    kick_boxing = 50
    snowboarding = 51
    endurance = 52
    power = 53
    speed_agility = 54
    strength = 55
    cross_training = 56
    elliptical = 57
    functional_strength_training = 58
    hiking = 59
    hunting = 60
    mind_and_body = 61
    play = 62
    preparation_and_recovery = 63
    stair_climbing = 64
    traditional_strength_training = 65
    walking = 66
    water_fitness = 67
    yoga = 68
    barre = 69
    core_training = 70
    flexibility = 71
    high_intensity_interval_training = 72
    jump_rope = 73
    pilates = 74
    stairs = 75
    step_training = 76
    wheelchair_walk_pace = 77
    wheelchair_run_pace = 78
    taichi = 79
    mixed_cardio = 80
    hand_cycling = 81
    climbing = 82
    other = 83
```


#### Session Source
``` 
    user = 0
    health = 1
    user_health = 2
    three_sensor = 3
```



### Body Part Types

#### Joints
The following reportable body parts are considered joints
```
    elbow = 19
    wrist = 20
    knee = 7
    ankle = 9
    foot = 10
```
#### Ligaments
The following reportable body parts are considered ligaments
```
    it_band = 11
    it_band_lateral_knee = 27
    achilles = 17
```

#### Muscles
The following reportable body parts are considered ligaments
```
    chest = 2
    abdominals = 3
    groin = 5
    quads = 6
    shin = 8
    lower_back = 12
    glutes = 14
    hamstrings = 15
    calves = 16
    upper_back_neck = 18
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    hip_flexor = 28
    deltoid = 29
```
