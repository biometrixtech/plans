<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Plans API](#plans-api)
  - [Common provisions](#common-provisions)
      - [Terminology](#terminology)
      - [Protocol](#protocol)
      - [Encoding](#encoding)
      - [Authentication](#authentication)
      - [General responses](#general-responses)
  - [Schema](#schema)
    - [Simple](#simple)
  - [Endpoints](#endpoints)
    - [Daily Readiness](#daily-readiness)
      - [Create](#create)
      - [Soreness history](#soreness-history)
    - [Post-Session Survey (Deprecated)](#post-session-survey-deprecated)
      - [Create](#create-1)
    - [Session](#session)
      - [Create](#create-2)
      - [Get Typical Sessions](#get-typical-sessions)
      - [Mark no sessions planned](#mark-no-sessions-planned)
      - [Delete](#delete)
      - [Update](#update)
      - [Send sensor data](#send-sensor-data)
    - [Active Recovery](#active-recovery)
      - [Mark Started](#mark-started)
      - [Mark Completed](#mark-completed)
      - [Adjust active time](#adjust-active-time)
    - [Functional Strength](#functional-strength)
      - [Mark Started](#mark-started-1)
      - [Mark Completed](#mark-completed-1)
    - [Daily Plans](#daily-plans)
      - [Get daily plan](#get-daily-plan)
    - [Coach Dashboard](#coach-dashboard)
      - [Get dashboard data for all users](#get-dashboard-data-for-all-users)
    - [Athlete](#athlete)
      - [Athlete Survey](#athlete-survey)
    - [Misc](#misc)
      - [Clear user's data](#clear-users-data)
      - [Log App/Device information](#log-appdevice-information)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Plans API

## Common provisions

#### Terminology

The terminology of [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt) (specifically __must__, __should__, __may__ and their negatives) applies.  The word __will__, when applied to the Plans API ("the API"), has the same meaning as __must__.

#### Protocol

The API supports communication over HTTPS only.

#### Encoding

The API supports communication using JSON encoding only.  The client __must__ submit the headers `Content-Type: application/json` and `Accept: application/json` for all requests.  Failure to do so __will__ result in a `415 Unsupported Media Type` response.  The API __will__ include the header `Content-Type: application/json` with its response.

#### Authentication

Unless otherwise specified, the endpoints in the API are authenticated by a JWT bearer token.  One token source are accepted:

* Tokens generated by Amazon Cognito and acquired as part of authentication to the Users Service;

The client __must__ submit the header `Authorization: <JWT>` with all requests. Failure to do so, or submitting an invalid or expired JWT, __will__ result in a `401 Unauthorized` response.  

#### General responses

In addition to the AWS API Gateway responses and the specific responses for each endpoint, the server __may__ respond with one of the following HTTP responses:

* `400 Bad Request` with `Status` header equal to `InvalidSchema`, if the JSON body of the request does not match the requirements of the endpoint.
* `403 Forbidden` with `Status` header equal to `Forbidden`, if the user is not allowed to perform the requested action.
* `404 Unknown` with `Status` header equal to `UnknownEndpoint`, if an invalid endpoint was requested.

## Schema

### Simple

The following simple types __may__ be used in responses:

* `string`, `number`: as defined in the [JSON Schema](http://json-schema.org) standard.
* `Uuid`: a `string` matching the regular expression `^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$`, that is, the string representation of an [RFC 4122](https://tools.ietf.org/html/rfc4122) UUID.
* `Datetime`: a `string` matching the regular expression `/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|+\d{2}:\d{2})/` and representing a date and time in full [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

## Endpoints

### Daily Readiness

#### Create

This endpoint can be called to register a new daily readiness survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/daily_readiness`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "date_time": Datetime,
    "user_id": Uuid,
    "soreness": [sore_part, sore_part],
    "clear_candidates": [sore_part, sore_part]
    "sleep_quality": number,
    "readines": number,
    "wants_functional_strength": boolean,
    "current_sport_name": number,
    "current_position": number,
    "sessions": [session, session],
    "sessions_planned": boolean
}
```
* `date_time` __should__ reflect the local time that survey was taken
* `soreness` __should__ reflect the number of body part that the user indicated soreness that were not candidates for clearance. Length __could__ be 0.
* `clear_candidates` __should__ include body parts that were candidates to be cleared of historical status. Note this should include the body part even if marked "all_clear".
* `sleep_quality` __should__ be an integer between 1 and 10
* `readiness` __should__ be an integer between 1 and 10
* `wants_functional_strength` is optional argument only for the users that are eligible for functional strength and should be included once they are eligible
* `current_sport_name` __should__ be integer representing SportName enumeration
* `current_position` __should__ be integer representating position enumeration for specific sport or NoSportPosition enumeration
* `sessions` __should__ be a list of session, where each session matches the body of [Create](#create-2) Session with `user_id` removed.
* `sessions_planned` __should__ be a boolean representing whether the user plans to train again that day.
* `sore_part` __should__ have the following schema:
```
{
    "body_part": number,
    "severity": number,
    "side": number,
    "pain": boolean,
    status: string
}
```
* `body_part` __should__ be an integer reflecting BodyPart enum
* `severity` __should__ be an integer between 0 and 5. (0 is only allowed for clear_candidates)
* `side` __should__ be an integer between 0 and 2
* `pain` __should__ be a boolean to indicate whether it's pain or soreness.
* `status` __should__ be a string representating the historical soreness status if one was received. Optional for soreness but required for clear candidates.

Note: `current_sport_name` and `current_position` are only required when the user is first eligible for functional strength. `current_position` should always be present. `current_sport` is optional and if it's absent, NoSportPosition is assumed for `current_position`.

```
POST /plans/version/daily_readiness HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "date_time": "2018-12-10T17:45:24Z",
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "soreness":[{"body_part": 18, "severity": 2, "side": 0}],
    "clear_candidates": [{"body_part": 5, "severity": 0, "side": 1, "pain":true, "status": "persistant_2_pain"}]
    "sleep_quality":4,
    "readiness":4,
    "wants_functional_strength": true,
    "current_sport_name": 14,
    "current_position": 1,
    "sessions": [{"event_date": "2018-12-10T12:30:00Z",
                  "session_type": 0,
                  "sport_name": 0,
                  "duration": 90,
                  "description": "Evening Practice",
                  "post_session_survey": {
                                         "event_date": "2018-12-10T17:45:24Z",
                                         "RPE": 9,
                                         "soreness": []
                                        }
                  }
                ],
    "sessions_planned": false
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


#### Soreness history

This endpoint can be called to get the body parts where soreness was reported in the last report as well as the user's eligibility status for functional strength.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/daily_readiness/previous`. The request method __must__ be `GET` or `POST`.

##### Request
For `POST` method, the client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
```
GET /plans/version/daily_readiness/previous HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

```
Authentication is required for this endpoint

##### Responses
 
 The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "body_parts": [
                {"body_part": number, "side": number, "status": string},
                {"body_part": number, "side": number, "status": string}
                ],
    "hist_sore_status": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "clear_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "dormant_tipping_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "completed_functional_strength_sessions": number,
    "current_position": number,
    "current_sport_name": number,
    "functional_strength_eligible": boolean,
}
```
* `body_part` will be a list of enumerated body parts + side (potentially empty)
* `clear_candidates` will be a list of sore body parts with historical status that are candidates for clearance
* `hist_sore_status` will be a list of sore body parts with historical status that are not candidates for clearing
* `dormant_tipping_candidates` will be a list of sore body parts that should not prompt a response for the user but if they indicate a status for that, they will tip into specific status as defined in the response
* `completed_functional_strength_sessions` will be a count of completed functional strength sessions for the last week
* `current_position` and `current_sport_name` will be enumeration
* `current_position` exists but `current_sport_name` does not, then it's implied that the user wants functional strength for sport-less activity



### Post-Session Survey (Deprecated)

#### Create

This endpoint can be called to register a a post-session survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/post_session_survey`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "session_id": Uuid,
    "session_type": number,
    "survey": {
      "RPE": number,
      "soreness": [{"body_part": number, "severity": number, "side": number, "pain", boolean}]
    }
}
```
* `event_date` __should__ reflect the date and time when the survey happened
* `session_id` __should__ be id of the session associated. It's __optional__ if the survey is associated with new session that doesn't exist in daily_plan
* `session_type` __should__ be an integer reflecting enumeration of different session type (0-5)
* `RPE` __should__ be an integer between 1 and 10
* `soreness` __should__ follow the same definition as in readiness_survey

```
POST /plans/version/post_session_survey HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "event_date": "2018-07-03",
    "session_id": "69223f69-08b2-4e61-be2a-0e9b38787cec",
    "session_type": 1,
    "survey": 
            {
               "RPE": 4,
               "soreness": [
                  {"body_part": 17.0, "severity": 5, "side": 0, pain: false},
                  {"body_part": 14, "severity": 3, "side": 0, pain: false}
                  ]
            }
            
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Session

#### Create

This endpoint can be called to log a new session to today's plan and should include the session information as well as post-session surveys for the session being logged.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "sport_name": number,
    "session_type": number,
    "duration": number,
    "description": string,
    "post_session_survey": {
                            "event_date": Datetime
                            "RPE": number,
                            "soreness": [{"body_part": number, "severity": number, "side": number, "pain", boolean}]
                        }
}
```
* `event_date` __should__ reflect the date and time the session is scheduled for.
* `session_type` __should__ be an integer reflecting SessionType enumeration.
* `sport_name` __should__ be an integer reflecting SportName enumeration.
* `strength_and_conditioning_type` __should__ be an integer reflecting StrengthAndContioningType enumeration
* `duration` __should__ be in minutes and reflect the length of time the session is scheduled for.
* `description` is __optional__ parameter to provide short description of the session they're adding

Note: A session will either have `sport_name` or `strength_and_conditioning_type` `session_type=1` will have `strength_and_conditioning_type` and `session_type=1=0,2,3,6` will have `sport_name` associated
```
POST /plans/version/session HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-14T19:54:48Z",
    "session_type": 0,
    "sport_name": 0,
    "duration": 90,
    "description": "Evening Practice",
    "post_session_survey": {
               "event_date": "2018-09-14T19:54:48Z",
               "RPE": 5,
               "soreness": [
                            {"body_part": 16, "severity": 3, "pain": false, "side": 1},
                            {"body_part": 6, "severity": 2, "pain": false, "side": 2},
                            ]
            }
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Get Typical Sessions

This endpoint can be called to get the typical sessions the user has logged in the past two weeks ordered by their occurence. Only the top four most occuring session types will be returned.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/typical`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/version/session/typical HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-14T19:54:48Z"
}
```
##### Responses
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "typical_sessions": [session, session]
}
```
each session object will be of the following schema

``` 
{
    "count": 4,
    "duration": 25,
    "event_date": "2018-09-19T15:30:00Z",
    "session_type": 0,
    "sport_name": 5,
    "strength_and_conditioning_type": null
}
```

#### Mark no sessions planned

This endpoint can be called to notify that no sessios are planned for the day.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/no_session`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/version/session/no_session HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-14T19:54:48Z"

}
```
##### Responses
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plan": daily_plan
}
```
where `daily_plan` will have the standard schema.

#### Delete

This endpoint can be called to delete existing externally regimented session from today or yesterday's plan.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{session_id}`. The request method __must__ be `DELETE`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "session_type": number
}
```
* `event_date` __should__ reflect the date and time the session was scheduled for.
* `session_type` __should__ be an integer reflecting SessionType enumeration.

```
DELETE /plans/version/session/73e8f603-d2d5-423a-b2b6-fe0996a373c8 HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "event_date": "2018-08-10T16:30:00Z",
    "session_type": 0
}
```
##### Responses
 
 If the delete was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Update

This endpoint can be called to update the details of an existing session that hasn't already been logged. This endpoint can be called to reschedule a session, or change duration/sport/session type/description of the session.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{session_id}`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "sport_name": number,
    "session_type": number,
    "duration": number,
    "description": string
}
```
* `event_date` __should__ reflect the date and time the session is scheduled for. If the session is being recheduled, it should reflect the new time.
* `session_type` __should__ be an integer reflecting SessionType enumeration.
* `sport_name` __should__ be an integer reflecting SportName enumeration.
* `duration` __should__ be in minutes and reflect the length of time the session is scheduled for.
* `description` is __optional__ parameter to provide short description of the session they're adding

```
PATCH /plans/version/session/73e8f603-d2d5-423a-b2b6-fe0996a373c8 HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "event_date": "2018-08-10T16:30:00Z",
    "session_type": 1,
    "sport_name": 5,
    "duration": 90,
    "description": "Late Afteronoon Practice"
}
```
##### Responses
 
 If the update was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Send sensor data

This endpoint can be called to write sensor data for sessions(s)

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/sensor_data`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "last_sensor_sync": Datetime
    "sessions": [Session]
}
```
A `Session` object __will__ have the following schema:

```
{
    "session_id": Uuid,
    "session_type": number,
    "event_date": Datetime
    "start_time": Datetime,
    "end_time": Datetime,
    "inactive_duration": number,
    "low_duration": number, 
    "mod_duration": number,
    "high_duration": number,
    "inactive_accel": number,
    "low_accel": number, 
    "mod_accel": number,
    "high_accel": number

}
```
* `session_id` , `session_type` and `event_date` are optional arguments


```
POST /plans/version/session/sensor_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "last_sensor_sync": "2018-09-05T14:06:44Z",
    "sessions":
    [
        {
            "start_time": "2018-07-18T13:40:20Z",
            "end_time": "2018-07-18T14:40:20Z",
            "inactive_duration": 1500,
            "low_duration": 500, 
            "mod_duration": 200,
            "high_duration": 60,
            "inactive_accel": 1500,
            "low_accel": 500, 
            "mod_accel": 200,
            "high_accel": 60
        }
    ]
}
```
##### Responses
 
 If all sessions were updated successfully, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Active Recovery

#### Mark Started

This endpoint can be called to mark either the pre- or post-recovery started.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the first exercise for the session.
* `recovery_type` __should__ be either `pre` or `post`

```
POST /plans/version/active_recovery HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "pre"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed

This endpoint can be called to mark either the pre- or post-recovery completed.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "recovery_type": string
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be either `pre` or `post`

```
PATCH /plans/version/active_recovery HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "post",
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.


#### Adjust active time

This endpoint can be called to adjust the active time for either pre- or post-recovery.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/active_time`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "active_time": number
}
```
* `event_date` __should__ be the time when user makes the request
* `active_time` __should__ be in minutes

```
PATCH /plans/version/active_recovery/active_time HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-21T17:53:39Z",
    "active_time": 20
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK` with a body with the following syntax:
```
{
    "message": "success"
}
```

### Functional Strength

#### Mark Started

This endpoint can be called to mark functional strength start.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/functional_strength`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
}
```
* `event_date` __should__ be the time when user starts (checks the first exercise off) the session.

```
POST /plans/version/functional_strength HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-21T17:53:39Z"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed

This endpoint can be called to mark functional strength completion.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/functional_strength`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.

```
PATCH /plans/version/functional_strength HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id":"a1233423-73d3-4761-ac92-89cc15921d34",
    "event_date": "2018-09-21T17:53:39Z",
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.



### Daily Plans

#### Get daily plan

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/daily_plan`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime
    "start_date": string,
    "end_date": string
}
```
* `event_date` __should__ reflect the time (in local timezone) when the api call is made.
* `start_date` __should__ should be of format `yyyy-mm-dd`
* `end_date` __should__ should be of format `yyyy-mm-dd` but is __optional__

```
POST /plans/version/daily_plan HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "event_date": "2018-07-31T02:50:02Z",
    "start_date": "2018-07-31"
}
```
##### Responses
 
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan1, daily_plan2]
}
```
* `daily_plans` __could__ be emply list
* each `daily_plan*` will be of following syntax:
```
{
    "bump_up_sessions": [],
    "completed_functional_strength_sessions": 2,
    "completed_post_recovery_sessions": [],
    "cross_training_sessions": [],
    "daily_readiness_survey_completed": true,
    "date": "2018-10-01",
    "day_of_week": 0,
    "functional_strength_completed": false,
    "functional_strength_eligible": true,
    "functional_strength_session": {
        "completed": false,
        "dynamic_movement": [
            {
                "bilateral": true,
                "description": "Place a small resistance band around your ankles. Step out until you feel adequate resistance in the band. Stand up onto your toes to perform a calf raise against the resistance of the band. Repeat for the designated reps.",
                "display_name": "Banded Calf Raises",
                "goal_text": "",
                "library_id": "184",
                "name": "Banded Calf Raises",
                "position_order": 0,
                "reps_assigned": 15,
                "seconds_duration": 90,
                "seconds_per_rep": 3,
                "seconds_per_set": null,
                "sets_assigned": 1,
                "unit_of_measure": "count",
                "youtube_id": null
            }
        ],
        "equipment_required": [],
        "event_date": null,
        "minutes_duration": 31.449999999999996,
        "position": 0,
        "sport_name": null,
        "stability_work": [
            {
                "bilateral": false,
                "description": "Lay down on your back. Keep your hands by your sides, engage your core, and lift your legs up as far as you can. Make sure your back stays flush with the ground as your lower back to the ground. Do not let your feet touch the floor between reps. Complete for the designated reps.",
                "display_name": "Leg Lifts",
                "goal_text": "",
                "library_id": "198",
                "name": "Leg Lifts",
                "position_order": 0,
                "reps_assigned": 15,
                "seconds_duration": 45,
                "seconds_per_rep": 3,
                "seconds_per_set": null,
                "sets_assigned": 1,
                "unit_of_measure": "count",
                "youtube_id": null
            }
        ],
        "start_date": null,
        "victory_lap": [
            {
                "bilateral": true,
                "description": "Begin in a plank position on your hands. Alternate tapping your shoulders with the opposite arms. Be sure to keep your body in line and core tight as you move. Complete for the designated time.",
                "display_name": "Plank with Shoulder Taps",
                "goal_text": "",
                "library_id": "202",
                "name": "Plank with Shoulder Taps",
                "position_order": 0,
                "reps_assigned": 30,
                "seconds_duration": 60,
                "seconds_per_rep": null,
                "seconds_per_set": 30,
                "sets_assigned": 1,
                "unit_of_measure": "seconds",
                "youtube_id": null
            }
        ],
        "warm_up": [
            {
                "bilateral": true,
                "description": "Laying on your back with your arms in a T-position, bring one leg up toward the opposite arm as far as you can without lifting your midback off the ground. Bring that leg back down to the starting position, then repeat on the other side. Complete for the set number of reps.",
                "display_name": "Iron Cross",
                "goal_text": "",
                "library_id": "144",
                "name": "Iron Cross",
                "position_order": 0,
                "reps_assigned": 10,
                "seconds_duration": 60,
                "seconds_per_rep": 3,
                "seconds_per_set": null,
                "sets_assigned": 1,
                "unit_of_measure": "count",
                "youtube_id": null
            }
        ]
    },
    "game_sessions": [],
    "landing_screen": 0,
    "last_sensor_sync": "2018-09-14T10:00:41Z",
    "last_updated": "2018-10-01T17:53:28Z",
    "nav_bar_indicator": 0,
    "post_recovery": {
        "activate_exercises": [],
        "activate_iterations": 0,
        "completed": false,
        "display_exercises": false,
        "event_date": null,
        "goal_text": "",
        "impact_score": 0,
        "inhibit_exercises": [],
        "inhibit_iterations": 0,
        "integrate_exercises": [],
        "integrate_iterations": 0,
        "lengthen_exercises": [],
        "lengthen_iterations": 0,
        "minutes_duration": 0,
        "start_date": null,
        "why_text": ""
    },
    "post_recovery_completed": false,
    "practice_sessions": [],
    "pre_recovery": {
        "activate_exercises": [
            {
                "bilateral": true,
                "description": "Sit or stand with your shoulders level and your back straight. Bring your shoulders up into shrug, bringing them as close to your ears as you can. Relax and let your shoulders fall back to the starting position. Repeat for the recommended number of reps.",
                "display_name": "Shoulder Shrugs",
                "goal_text": "Focused muscle activation",
                "library_id": "137",
                "name": "Scapular Elevation",
                "position_order": 13,
                "reps_assigned": 10,
                "seconds_duration": 40,
                "seconds_per_rep": 2,
                "seconds_per_set": null,
                "sets_assigned": 1,
                "unit_of_measure": "count",
                "youtube_id": null
            }
        ],
        "activate_iterations": 10,
        "completed": false,
        "display_exercises": true,
        "event_date": null,
        "goal_text": "Stay loose! Focus on increasing flexibility and building stamina!",
        "impact_score": 2.9047619047619047,
        "inhibit_exercises": [
            {
                "bilateral": true,
                "description": "Stand with your back against a wall. Place a ball between the wall and on your upper back, in between your shoulder and neck. If you feel have any points of tenderness in this area, you may place the ball over those. Keeping the ball in contact with the wall, push your thumb into the muscle from the front. Bend your neck as far as you can and look straight down. Apply pressure for 30 seconds, then release. ",
                "display_name": "Upper Back Release",
                "goal_text": "Increase blood flow",
                "library_id": "126",
                "name": "SMR - Upper Trapezius",
                "position_order": 3,
                "reps_assigned": 30,
                "seconds_duration": 60,
                "seconds_per_rep": null,
                "seconds_per_set": 30,
                "sets_assigned": 1,
                "unit_of_measure": "seconds",
                "youtube_id": null
            }
        ],
        "inhibit_iterations": 1,
        "integrate_exercises": [],
        "integrate_iterations": 0,
        "lengthen_exercises": [
            {
                "bilateral": true,
                "description": "Stand feet shoulder-width apart and cross one arm over your body at chest-level. Apply pressure on your forearm with your other hand to stretch the back of your shoulder. Hold for 30 seconds, then repeat on the othe side.",
                "display_name": "Cross Body Arm Stretch",
                "goal_text": "Increase flexibility",
                "library_id": "130",
                "name": "Posterior Deltoid Static Stretch",
                "position_order": 7,
                "reps_assigned": 30,
                "seconds_duration": 60,
                "seconds_per_rep": null,
                "seconds_per_set": 30,
                "sets_assigned": 1,
                "unit_of_measure": "seconds",
                "youtube_id": null
            }
        ],
        "lengthen_iterations": 8,
        "minutes_duration": 14.133333333333333,
        "start_date": null,
        "why_text": "mild soreness and discomfort"
    },
    "pre_recovery_completed": false,
    "sessions_planned": true,
    "training_sessions": []
    }
```

### Coach Dashboard

#### Get dashboard data for all users
This endpoint can used get relevant data for all the users across all the team the user is a coach for. Note that the user needs to be a coach for all the teams they belong to.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/coach/{user_id}/dashboard`. The request method __must__ be `GET`.

##### Request
A body is not required for this request

```
GET /plans/version/coach/{user_id}/dashboard HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
```
##### Responses
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{"teams": [team, team]}
```
where team has the following schema
```
{
    "name": string,
    "compliance": compliance,
    "daily_insights": daily_insights,
    "weekly_insights": weekly_insights,
    "athletes": [athlete, athlete]
}
```
* `compliance` would be of format
```
{
    "completed": [user, user],
    "incomplete": [user, user],
    "training_compliance": training_compliance
}
```
* `training_compliance` will have the following schema
```
{
  "no_response": [user, user, user],
  "rest_day": [user, user],
  "sessions_logged": [user, user]
}
```
where `user` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string
}
```
* `daily_insights` will have the following schema
```
{
    "all_good": [user],
    "balance_overtraining_risk": [user, user],
    "add_variety_to_training_risk": [user, user, user],
    "increase_weekly_workload": [user, user, user],
    "address_pain_or_soreness": [user, user, user],
    "evaluate_health_status": [user, user, user]
}
```

* `weekly_insights` will have the following schema
```
{
    "all_good": [user],
    "increase_workload": [user, user],
    "limit_time_intensity_of_training": [user, user, user],
    "monitor_in_training": [user, user, user],
    "not_cleared_for_training": [user, user, user]
}
```
where `user` in `daily_insights` and `weekly_insights`has the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number
}
```
* `athlete` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number,
    "daily_recommendation": [string, string],
    "weekly_recommendation": [string, string],
    "insights': [string, string]
}
```

### Athlete

#### Athlete Survey
This endpoint can used to submit user survey.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/athlete/{athlete_id}/survey`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "wearable_devices": [string, string],
    "typical_weekly_sessions": string
}
```

```
POST /plans/version/athlete/02cb7965-7921-493a-80d4-6b278c928fad/survey HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "wearable_devices": ["Fitbit", "Garmin", "Whoop"],
    "typical_weekly_sessions": "1-3"
}
```
##### Responses
 If successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Misc

#### Clear user's data
This endpoint can used to clear the user's data for the given day. Note that his endpoint is restricted to select demo accounts and user must be authorized to perform the action. It will clear out users daily readiness survey and their plan for the day. If the request is made before 3 am, plan and surveys for the previous day will be cleared which is consistent with 3am being the cutoff time for the new daily plan.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/clear_user_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the local date and time when the request was made

```
POST /plans/version/misc/clear_user_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-13T11:12:30Z"
}
```
##### Responses
 If clearing data was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Log App/Device information
This endpoingt can be used to log relevant device/app information and usage

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/app_logs`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "os_name": string,
    "os_version": string,
    "app_version": string

}
```
* `event_date` __should__ reflect the local date and time when the request was made
* `os_name` __should__ be the os name (Android/iOS)
* `os_version` __should__ be the version of os running on the device
* `app_version` __should__ be the version of app installed


```
POST /plans/version/misc/app_logs HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-12-13T18:19:50Z",
    "os_name": Android,
    "os_version": "8.1.0",
    "app_version": "2.2.9"
}
```
##### Responses
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```





