<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Plans API](#plans-api)
  - [Common provisions](#common-provisions)
      - [Terminology](#terminology)
      - [Protocol](#protocol)
      - [Encoding](#encoding)
      - [Authentication](#authentication)
      - [General responses](#general-responses)
  - [Schema](#schema)
    - [Simple](#simple)
  - [Endpoints](#endpoints)
    - [Daily Readiness](#daily-readiness)
      - [Create](#create)
      - [Soreness/Typical Session history](#sorenesstypical-session-history)
    - [Post-Session Survey (Deprecated)](#post-session-survey-deprecated)
      - [Create](#create-1)
    - [Session](#session)
      - [Create](#create-2)
      - [Get Typical Sessions (Deprecated)](#get-typical-sessions-deprecated)
      - [Mark no sessions planned](#mark-no-sessions-planned)
      - [Delete](#delete)
      - [Update](#update)
      - [Send sensor data](#send-sensor-data)
    - [Active Recovery](#active-recovery)
      - [Mark Started (Exercise Modalities)](#mark-started-exercise-modalities)
      - [Mark Completed (Exercise Modalities)](#mark-completed-exercise-modalities)
      - [Mark Started (Body Part Modalities)](#mark-started-body-part-modalities)
      - [Mark Completed (Body Part Modalities)](#mark-completed-body-part-modalities)
      - [Adjust active time (Deprecated)](#adjust-active-time-deprecated)
    - [Functional Strength](#functional-strength)
      - [Activate](#activate)
      - [Mark Started](#mark-started)
      - [Mark Completed](#mark-completed)
    - [Daily Plans](#daily-plans)
      - [Get daily plan](#get-daily-plan)
    - [Coach Dashboard](#coach-dashboard)
      - [Get dashboard data for all users](#get-dashboard-data-for-all-users)
    - [Athlete](#athlete)
      - [Athlete Survey](#athlete-survey)
    - [Health Data](#health-data)
      - [Sync health data](#sync-health-data)
    - [Misc](#misc)
      - [Clear user's data](#clear-users-data)
      - [Log App/Device information](#log-appdevice-information)
      - [Copy test user's data](#copy-test-users-data)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Plans API

## Common provisions

#### Terminology

The terminology of [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt) (specifically __must__, __should__, __may__ and their negatives) applies.  The word __will__, when applied to the Plans API ("the API"), has the same meaning as __must__.

#### Protocol

The API supports communication over HTTPS only.

#### Encoding

The API supports communication using JSON encoding only.  The client __must__ submit the headers `Content-Type: application/json` and `Accept: application/json` for all requests.  Failure to do so __will__ result in a `415 Unsupported Media Type` response.  The API __will__ include the header `Content-Type: application/json` with its response.

#### Authentication

Unless otherwise specified, the endpoints in the API are authenticated by a JWT bearer token.  One token source is accepted:

* Tokens generated by Amazon Cognito and acquired as part of authentication to the Users Service;

The client __must__ submit the header `Authorization: <JWT>` with all requests. Failure to do so, or submitting an invalid or expired JWT, __will__ result in a `401 Unauthorized` response.  

#### General responses

In addition to the AWS API Gateway responses and the specific responses for each endpoint, the server __may__ respond with one of the following HTTP responses:

* `400 Bad Request` with `Status` header equal to `InvalidSchema`, if the JSON body of the request does not match the requirements of the endpoint.
* `403 Forbidden` with `Status` header equal to `Forbidden`, if the user is not allowed to perform the requested action.
* `404 Unknown` with `Status` header equal to `UnknownEndpoint`, if an invalid endpoint was requested.

## Schema

### Simple

The following simple types __may__ be used in responses:

* `string`, `number`, `integer`, `boolean`: as defined in the [JSON Schema](http://json-schema.org) standard.
* `Uuid`: a `string` matching the regular expression `^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$`, that is, the string representation of an [RFC 4122](https://tools.ietf.org/html/rfc4122) UUID.
* `Datetime`: a `string` matching the regular expression `/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|+\d{2}:\d{2})/` and representing a date and time in full [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

## Endpoints

### Daily Readiness

#### Create

This endpoint can be called to register a new daily readiness survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/{User UUID}/daily_readiness`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "date_time": Datetime,
    "soreness": [sore_part, sore_part],
    "clear_candidates": [sore_part, sore_part]
    "sleep_quality": number,
    "readines": number,
    "sessions": [session, session],
    "sessions_planned": boolean,
    "sleep_data": [sleep_event, sleep_event],
    "health_sync_date": Datetime
}
```
* `date_time` __should__  be a Datetime and reflect the local time that survey was taken
* `soreness` __should__ reflect a list of body parts(`sore_part`) with pain or soreness. Length __could__ be 0.
* `clear_candidates` __should__ include body parts that were candidates to be cleared of historical status. Note this should include the body part even if marked "all_clear".
* `sleep_quality` __should__ be an integer between 1 and 10 or null
* `readiness` __should__ be an integer between 1 and 10 or null
* `sessions` __should__ be a list of session objects, where each session matches the body of [Create](#create-2) Session.
* `sleep_data` __should__ be a list of sleep_events.
* `sessions_planned` __should__ be a boolean representing whether the user plans to train again that day.
* `health_sync_date` is __optional__ and only provided if one of the sessions is obtained from health app
* `sore_part` __should__ have the following schema:
```
{
    "body_part": number,
    "severity": number,
    "side": number,
    "pain": boolean,
    "status": string
}
```
* `body_part` __should__ be an integer reflecting BodyPart enum

[//]: # (TODO: Should this include severity and movement?)

* `severity` __should__ be an integer between 0 and 5. (0 is only allowed for clear_candidates)
* `side` __should__ be an integer, either 0 (both sides/non-bilateral), 1 (left) or 2 (right)
* `pain` __should__ be a boolean to indicate whether it's pain or soreness.
* `status` __should__ be a string representating the historical soreness status if one was received. Optional for soreness but required for clear candidates.

[//]: # (TODO: UPDATE URL)

```
POST /plans/version/daily_readiness HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "date_time": "2018-12-10T17:45:24Z",
    "soreness":[{"body_part": 18, "severity": 2, "side": 0}],
    "clear_candidates": [{"body_part": 5, "severity": 0, "side": 1, "pain":true, "status": "persistant_2_pain"}]
    "sleep_quality":4,
    "readiness":4,
    "wants_functional_strength": true,
    "current_sport_name": 14,
    "current_position": 1,
    "sessions": [{"event_date": "2018-12-10T12:30:00Z",
                  "session_type": 0,
                  "sport_name": 0,
                  "duration": 90,
                  "description": "Evening Practice",
                  "post_session_survey": {
                                         "event_date": "2018-12-10T17:45:24Z",
                                         "RPE": 9,
                                         "soreness": []
                                        }
                  }
                ],
    "sessions_planned": false,
    "sleep_data": [{"value": "INBED", "startDate": "2019-01-09T00:09:50.212-0500", "endDate": "2019-01-09T07:35:21.256-0500"}]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.


#### Soreness/Typical Session history

This endpoint can be called to get the body parts where soreness was reported in the last three days and typical sessions.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/daily_readiness/previous`. The request method __must__ be `POST`.

##### Request
For `POST` method, the client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
```
POST /plans/version/daily_readiness/previous HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

```
Authentication is required for this endpoint

##### Responses
 
 The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
"readiness": readiness,
"typical_sessions": [sesson, session]
```
* `readiness` will have the following schema
```
{
    "body_parts": [
                {"body_part": number, "side": number, "status": string},
                {"body_part": number, "side": number, "status": string}
                ],
    "hist_sore_status": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "clear_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "dormant_tipping_candidates": [{"body_part": number, "side": number, "status": string, pain: boolean}],
    "completed_functional_strength_sessions": number,
    "current_position": number,
    "current_sport_name": number,
    "functional_strength_eligible": boolean,
}
```
* `body_part` will be a list of enumerated body parts + side (potentially empty)
* `clear_candidates` will be a list of sore body parts with historical status that are candidates for clearance
* `hist_sore_status` will be a list of sore body parts with historical status that are not candidates for clearing
* `dormant_tipping_candidates` will be a list of sore body parts that should not prompt a response for the user but if they indicate a status for that, they will tip into specific status as defined in the response
* `completed_functional_strength_sessions` will be a count of completed functional strength sessions for the last week
* `current_position` and `current_sport_name` will be enumeration
* `current_position` exists but `current_sport_name` does not, then it's implied that the user wants functional strength for sport-less activity

* `typical sessions` will be a list of sessions that the user has logged in the last 14 days. 
* `session` object will be of the following schema

``` 
{
    "count": number,
    "duration": number,
    "event_date": datetime,
    "session_type": number,
    "sport_name": number,
    "strength_and_conditioning_type": number
}

```

### Post-Session Survey (Deprecated)

#### Create

This endpoint can be called to register a a post-session survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/post_session_survey`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "user_id": Uuid,
    "event_date": Datetime,
    "session_id": Uuid,
    "session_type": number,
    "survey": {
      "RPE": number,
      "soreness": [{"body_part": number, "severity": number, "side": number, "pain", boolean}]
    }
}
```
* `event_date` __should__ reflect the date and time when the survey happened
* `session_id` __should__ be id of the session associated. It's __optional__ if the survey is associated with new session that doesn't exist in daily_plan
* `session_type` __should__ be an integer reflecting enumeration of different session type (0-5)
* `RPE` __should__ be an integer between 1 and 10
* `soreness` __should__ follow the same definition as in readiness_survey

```
POST /plans/version/post_session_survey HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "user_id": "02cb7965-7921-493a-80d4-6b278c928fad",
    "event_date": "2018-07-03",
    "session_id": "69223f69-08b2-4e61-be2a-0e9b38787cec",
    "session_type": 1,
    "survey": 
            {
               "RPE": 4,
               "soreness": [
                  {"body_part": 17.0, "severity": 5, "side": 0, pain: false},
                  {"body_part": 14, "severity": 3, "side": 0, pain: false}
                  ]
            }
            
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Session

#### Create

This endpoint can be called to log a new session to today's plan and should include the session information as well as post-session surveys for the session being logged.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "sessions": [session, session],
    "health_sync_date": Datetime,
    "sessions_planned": Boolean
}
```
* `event_date` __should__ reflect the date and time when the survey is submitted.
* `health_sync_date` is __optional__ and only provided if one of the sessions is obtained from health app
* `session` __should__ be of the following schema
* `sessions_planned` __should__ be a boolean representing whether the user plans to train again that day.
```
{
    "event_date": Datetime,
    "end_date": Datetime,
    "session_type": number,
    "sport_name": number,
    "duration": number,
    "description": string,
    "calories": number,
    "distance": number,
    "source": number,
    "deleted": boolean,
    "ignored": boolean,
    "post_session_survey": {
                            "event_date": Datetime
                            "RPE": number,
                            "soreness": [sore_part, sore_part],
                            "clear_candidates": [sore_part]}
                        },
    "hr_data": [hr, hr, hr],
}
```
* `event_date` __should__ reflect the start time of the session (health data) or default date (manually logged session)
* `end_date` is __optional__ parameter that reflects the end time of the session for health data
* `session_type` __should__ be an integer reflecting SessionType enumeration. NOTE: We'll only use 6 moving forward
* `sport_name` __should__ be an integer reflecting SportName enumeration.
* `duration` __should__ be in minutes and reflect the duration which the user confirmend (health data) or entered (manually logged session).
* `calories` __if present__, __should__ be calorie information obtained from health workout _(only needed for health workout)_
* `distance` __if present__, __should__ be distance information obtained from health workout _(only needed for health workout)_
* `source` __if present__, __should__ be 0 for manually logged session and 1 for health data
* `deleted` __if present__, __should__ be true if the user deletes the workout detected from health app
* `ignored` __if present__, __should__ be true for short walking workouts.
* `hr_data` __if present__, __should__ be the heart rate data associated with the health workout. each hr will have `startDate`, `endDate` and `value` _(only needed for health workout)_
* `description` is __optional__ parameter to provide short description of the session they're adding

```
POST /plans/version/session HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "event_date": "2019-01-12T16:54:57Z",
    "sessions":[
                {
                    "event_date": "2019-01-12T10:41:57Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 14,
                    "description": "Evening Practice",
                    "calories": 100,
                    "distance": 200,
                    "end_date": "2019-02-12T10:54:57Z",
                    "source": 1,
                    "deleted": false,
                    "ignored": false,
                    "hr_data":  [
                                {"value": 153, "startDate": "2019-01-12T10:43:08.490-0500", "endDate": "2019-01-12T10:43:08.490-0500"},
                                {"value": 156, "startDate": "2019-01-12T10:43:03.490-0500", "endDate": "2019-01-12T10:43:03.490-0500"},
                                {"value": 161, "startDate": "2019-01-12T10:42:58.490-0500", "endDate": "2019-01-12T10:42:58.490-0500"},
                                {"value": 163, "startDate": "2019-01-12T10:42:56.490-0500", "endDate": "2019-01-12T10:42:56.490-0500"},
                                {"value": 167, "startDate": "2019-01-12T10:42:50.490-0500", "endDate": "2019-01-12T10:42:50.490-0500"},
                                {"value": 163, "startDate": "2019-01-12T10:42:47.490-0500", "endDate": "2019-01-12T10:42:47.490-0500"},
                                {"value": 127, "startDate": "2019-01-12T10:41:23.490-0500", "endDate": "2019-01-12T10:41:23.490-0500"}
                            ],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:54:57Z",
                                            "RPE": 5,
                                            "soreness": [],
                                            "clear_candidates": []
                                            }
                    }
                    
                ],
    "sessions_planned": true,
    "health_sync_date": "2019-02-08T16:54:57Z"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.

#### Get Typical Sessions (Deprecated)

This endpoint can be called to get the typical sessions the user has logged in the past two weeks ordered by their occurence. Only the top five most occuring session types will be returned.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/typical`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/version/session/typical HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "event_date": "2018-09-14T19:54:48Z"
}
```
##### Responses
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "typical_sessions": [session, session]
}
```
each session object will be of the following schema

``` 
{
    "count": 4,
    "duration": 25,
    "event_date": "2018-09-19T15:30:00Z",
    "session_type": 0,
    "sport_name": 5,
    "strength_and_conditioning_type": null
}
```

#### Mark no sessions planned

This endpoint can be called to notify that no sessios are planned for the day.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/no_session`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/version/session/no_session HTTP/1.1
Host: apis.dev.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
Postman-Token: 4b6c3946-89fd-4cde-ae29-3a4984d5f373

{
    "event_date": "2018-09-14T19:54:48Z"

}
```
##### Responses
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plan": daily_plan
}
```
where `daily_plan` will have the standard schema as defined in [Get daily plan](#get-daily-plan)

#### Delete

This endpoint can be called to delete existing externally regimented session from today or yesterday's plan.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{session_id}`. The request method __must__ be `DELETE`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "session_type": number
}
```
* `event_date` __should__ reflect the date and time the session was scheduled for.
* `session_type` __should__ be an integer reflecting SessionType enumeration.

```
DELETE /plans/version/session/73e8f603-d2d5-423a-b2b6-fe0996a373c8 HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-10T16:30:00Z",
    "session_type": 0
}
```
##### Responses
 
 If the delete was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Update

This endpoint can be called to update and combine manually logged session with a health app session

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/{session_id}`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "sessions": [session],
    "health_sync_date": Datetime
}
```
* `event_date` __should__ reflect the local date and time when the call is being made
* `session` __should__ follow the same schema as defined in [Create Session](#create-2)
* `health_sync_date` __should__ reflect the time when the data was obtained from health app

```
PATCH /plans/version/session/73e8f603-d2d5-423a-b2b6-fe0996a373c8 HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-02-08T16:30:00Z",
    "sessions": [
                 {
                    "event_date": "2019-02-08T16:45:55Z",
                    "end_date": "2019-02-08T16:45:55Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 90.5,
                    "calories": 50,
                    "distance": 100,
                    "source": 1,
                    "hr_data": [],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:30:00Z",
                                            "RPE": null,
                                            "soreness": [],
                                            "clear_candidates": []
                                            }

                }
                ],
    "health_sync_date": "2019-02-08T16:30:00Z"
}
```
##### Responses
 
 If the update was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Send sensor data

This endpoint can be called to write sensor data for sessions(s)

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/session/sensor_data`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "last_sensor_sync": Datetime
    "sessions": [Session]
}
```
A `Session` object __will__ have the following schema:

```
{
    "session_id": Uuid,
    "session_type": number,
    "event_date": Datetime
    "start_time": Datetime,
    "end_time": Datetime,
    "inactive_duration": number,
    "low_duration": number, 
    "mod_duration": number,
    "high_duration": number,
    "inactive_accel": number,
    "low_accel": number, 
    "mod_accel": number,
    "high_accel": number

}
```
* `session_id` , `session_type` and `event_date` are optional arguments


```
POST /plans/version/session/sensor_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "last_sensor_sync": "2018-09-05T14:06:44Z",
    "sessions":
    [
        {
            "start_time": "2018-07-18T13:40:20Z",
            "end_time": "2018-07-18T14:40:20Z",
            "inactive_duration": 1500,
            "low_duration": 500, 
            "mod_duration": 200,
            "high_duration": 60,
            "inactive_accel": 1500,
            "low_accel": 500, 
            "mod_accel": 200,
            "high_accel": 60
        }
    ]
}
```
##### Responses
 
 If all sessions were updated successfully, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Active Recovery

#### Mark Started (Exercise Modalities)

This endpoint can be called to mark the start of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/exercise_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the first exercise for the session.
* `recovery_type` __should__ be one of `pre_active_rest`, `post_active_rest` or `cool_down`

```
POST /plans/version/active_recovery/exercise_modalities HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "pre_active_rest"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Exercise Modalities)

This endpoint can be called to mark the completion of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/exercise_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be one of `pre_active_rest`, `post_active_rest` or `cool_down`
* `completed_exercises` __should__ be a list representing the exercises that the user checked off

```
PATCH /plans/version/active_recovery/exercise_modalities HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "post_active_rest",
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.



#### Mark Started (Body Part Modalities)

This endpoint can be called to mark the start of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/body_part_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the starts the session
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`

```
POST /plans/version/active_recovery/body_part_modalities HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "heat"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Body Part Modalities)

This endpoint can be called to mark the completion of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/body_part_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
    "completed_body_parts": [body_part]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`
* `completed_body_parts` __should__ be a list representing the body parts that the user selected from the provided list. It should be empty for `cold_water_immersion`.
* `body_part` __should__ be of the following schema. Note that there will be additional attributes based on whether it's `heat` or `ice`. They should just be passed along as is.
```
{
    "active": true,
    "body_part_location": 7,
    "completed": false,
    "goals": [
        {
            "goal_type": 0,
            "priority": 1,
            "text": "Care for Pain",
            "trigger": "Pain Reported Today"
        }
    ]
    "side": 1
}
```

```
PATCH /plans/version/active_recovery/body_part_modalities HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "ice",
    "completed_body_parts": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.


#### Adjust active time (Deprecated)

This endpoint can be called to adjust the active time for either pre- or post-recovery.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/active_recovery/active_time`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "active_time": number
}
```
* `event_date` __should__ be the time when user makes the request
* `active_time` __should__ be in minutes

```
PATCH /plans/version/active_recovery/active_time HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "active_time": 20
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK` with a body with the following syntax:
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.

### Functional Strength (Deprecated)

#### Activate

This endpoint can be called to activate functional strength and define sport and position.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/functional_strength/activate`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "current_sport_name": number
    "current_position": number
}
```
* `event_date` __should__ be the time when user submits the request
* `current_sport_name` __should__ be integer representing SportName enumeration
* `current_position` __should__ be integer representating position enumeration. It should be `null` if no positions exist for the sport.

```
POST /plans/version/functional_strength/activate HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-09-21T17:53:39Z",
    "current_sport_name": 14,
    "current_position": 0
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plan": daily_plan
}
```
where `daily_plan` will have the standard schema as defined in [Get daily plan](#get-daily-plan)

#### Mark Started (Deprecated)

This endpoint can be called to mark functional strength start.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/functional_strength`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
}
```
* `event_date` __should__ be the time when user starts (checks the first exercise off) the session.

```
POST /plans/version/functional_strength HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-09-21T17:53:39Z"
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Deprecated)

This endpoint can be called to mark functional strength completion.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/functional_strength`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.

```
PATCH /plans/version/functional_strength HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-09-21T17:53:39Z",
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following syntax.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same structure as defined in output of [Get daily plan](#get-daily-plan) route.



### Daily Plans

#### Get daily plan

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/daily_plan`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
    "start_date": string,
    "end_date": string
}
```
* `event_date` __should__ reflect the time (in local timezone) when the api call is made.
* `start_date` __should__ should be of format `yyyy-mm-dd`
* `end_date` __should__ should be of format `yyyy-mm-dd` but is __optional__

```
POST /plans/version/daily_plan HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-07-31T02:50:02Z",
    "start_date": "2018-07-31"
}
```
##### Responses
 
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "daily_plans": [daily_plan1, daily_plan2],
    "readiness": readiness,
    "typical_sessions": [session, session]
}
```
* `readiness` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined [here](#sorenesstypical-session-history)
* `typical_sessions` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined [here](#sorenesstypical-session-history)
* `daily_plans` __could__ be emply list
* each `daily_plan*` will be of following schema:
```
{
    "date": Date,
    "day_of_week": Number,
    "pre_active_rest": [PreActiveRest],
    "completed_pre_active_rest": [PreActiveRest],
    "heat": Heat,
    "completed_heat": [Heat],
    "warm_up": [WarmUp],
    "completed_warm_up": [WarmUp],
    "training_sessions": [Session],
    "cool_down": [CoolDown],
    "completed_cool_down": [CoolDown],
    "post_active_rest": [PostActiveRest],
    "completed_post_active_rest": [PostActiveRest],
    "ice": Ice,
    "completed_ice": [Ice],
    "cold_water_immersion": ColdWaterImmersion,
    "completed_cold_water_immersion": [ColdWaterImmersion],
    "cross_training_sessions": [],
    "daily_readiness_survey_completed": Boolean,
    "landing_screen": Number,
    "last_sensor_sync": Datetime,
    "last_updated": Datetime,
    "nav_bar_indicator": null,
    "post_active_rest_completed": Boolean,
    "pre_active_rest_completed": Boolean,
    "sessions_planned": Boolean,
    "train_later": Bolean
}
```
* Any of the `completed_*` attributes could be empty list
* Any of the exercise modalities (`pre_active_rest`, `post_active_rest`, `warm_up` and `cool_down`) could be empty list
* Any of the body part modalities (`heat`, `ice`, `cold_water_immersion`) could be null
* `Heat` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "before_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
```
* `Ice` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "after_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "immediately_after_training": false,
            "repeat_every_3hrs_for_24hrs": false,
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
```
* `ColdWaterImmersion` has following example schema
```
{
    "minutes": 10,
    "after_training"': true,
    "goals": [
        {
            "goal_type": 0,
            "priority": 1,
            "text": "Care for Pain",
            "trigger": "Pain Reported Today"
        }
    ],
    "start_date_time": null,
    "completed_date_time": null,
    "event_date_time": null,
    "completed": false,
    "active": true
}

```
* `PretActiveRest` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "active_stretch_exercises": [AssignedExercise, AssignedExercise]
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
    "muscular_strain_increasing": false,
    "start_date_time": null,
}
```
* `PostActiveRest` has following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "muscular_strain_increasing": false,
    "start_date_time": null,
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
}
```
* `CoolDown` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "dynamic_integrate_exercises": [AssignedExercise, AssignedExercise],
    "dynamic_stretch_exercises": [AssignedExercise, AssignedExercise],
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "muscular_strain_increasing": false,
    "sport_name": 17,
    "start_date_time": null
    }
```

* `AssignedExercise` has the following example schema
```
{
    "bilateral": true,
    "description": "Step forward and straighten your leg, lifting your toes off the ground as you lean down, moving your arms in a scooping motion. Straighten back up and repeat on the other leg as you take another step forward. ",
    "display_name": "Walking Hamstring Scoops",
    "dosages": [
        {
            "complete_reps_assigned": 12,
            "complete_sets_assigned": 1,
            "comprehensive_reps_assigned": 12,
            "comprehensive_sets_assigned": 1,
            "efficient_reps_assigned": 12,
            "efficient_sets_assigned": 1,
            "goal": {
                "goal_type": 2,
                "priority": 1,
                "text": "Recover from Sport",
                "trigger": "High Relative Volume or Intensity of Logged Session"
            },
            "priority": "1",
            "ranking": 0,
            "soreness_source": {
                "body_part": 13,
                "first_reported_date_time": null,
                "movement": null,
                "pain": false,
                "severity": 0.4,
                "side": null
            }
        }
    ],
    "duration_complete": null,
    "duration_comprehensive": null,
    "duration_efficient": null,
    "equipment_required": [
        "None"
    ],
    "goal_text": "",
    "library_id": "139",
    "name": "Walking Hamstring Scoops",
    "position_order": 0,
    "seconds_per_rep": null,
    "seconds_per_set": 30,
    "unit_of_measure": "yards",
    "youtube_id": null
}
```

### Coach Dashboard

#### Get dashboard data for all users
This endpoint can used get relevant data for all the users across all the team the user is a coach for. Note that the user needs to be a coach for all the teams they belong to.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/coach/{user_id}/dashboard`. The request method __must__ be `GET`.

##### Request
A body is not required for this request

```
GET /plans/version/coach/{user_id}/dashboard HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
```
##### Responses
The Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{"teams": [team, team]}
```
where team has the following schema
```
{
    "name": string,
    "compliance": compliance,
    "daily_insights": daily_insights,
    "weekly_insights": weekly_insights,
    "athletes": [athlete, athlete]
}
```
* `compliance` would be of format
```
{
    "completed": [user, user],
    "incomplete": [user, user],
    "training_compliance": training_compliance
}
```
* `training_compliance` will have the following schema
```
{
  "no_response": [user, user, user],
  "rest_day": [user, user],
  "sessions_logged": [user, user]
}
```
where `user` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string
}
```
* `daily_insights` will have the following schema
```
{
    "all_good": [user],
    "balance_overtraining_risk": [user, user],
    "add_variety_to_training_risk": [user, user, user],
    "increase_weekly_workload": [user, user, user],
    "address_pain_or_soreness": [user, user, user],
    "evaluate_health_status": [user, user, user]
}
```

* `weekly_insights` will have the following schema
```
{
    "all_good": [user],
    "increase_workload": [user, user],
    "limit_time_intensity_of_training": [user, user, user],
    "monitor_in_training": [user, user, user],
    "not_cleared_for_training": [user, user, user]
}
```
where `user` in `daily_insights` and `weekly_insights`has the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number
}
```
* `athlete` will have the following schema
```
{
    "user_id": Uuid,
    "first_name": string,
    "last_name": string,
    "cleared_to_train": Boolean,
    "color": Number,
    "daily_recommendation": [string, string],
    "weekly_recommendation": [string, string],
    "insights': [string, string]
}
```

### Athlete

#### Athlete Survey
This endpoint can used to submit user survey.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/athlete/{athlete_id}/survey`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "wearable_devices": [string, string],
    "typical_weekly_sessions": string
}
```

```
POST /plans/version/athlete/02cb7965-7921-493a-80d4-6b278c928fad/survey HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "wearable_devices": ["Fitbit", "Garmin", "Whoop"],
    "typical_weekly_sessions": "1-3"
}
```
##### Responses
 If successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```


### Health Data

#### Sync health data
This endpoint can used to submit health app workouts from missed days

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/health_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "start_date": Date,
    "end_date": Date,
    "sessions": [session, session],
    "sleep_data": [sleep_event, sleep_event],
}
```
* `event_date` __should__ reflect the local time the call is made
* `start_date` __should__ reflect the start date of the range of data being sent
* `end_date` __should__ reflect the end date of the range of data being sent
* `session` __should__ follow the same schema as defined in [Session Create](#create-2)
* `sleep_event` __should__ follow the same schema as defined in [Readiness Create](#create)

```
POST /plans/version/health_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-01-31T16:12:02Z",
    "start_date": "2019-01-29",
    "end_date": "2019-01-30",
    "sessions": [session1],
    "sleep_data": [sleep_event1, sleep_event2]
}
```
##### Responses
 If successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

### Misc

#### Clear user's data
This endpoint can used to clear the user's data for the given day. Note that his endpoint is restricted to select demo accounts and user must be authorized to perform the action. It will clear out users daily readiness survey and their plan for the day. If the request is made before 3 am, plan and surveys for the previous day will be cleared which is consistent with 3am being the cutoff time for the new daily plan.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/clear_user_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the local date and time when the request was made

```
POST /plans/version/misc/clear_user_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-13T11:12:30Z"
}
```
##### Responses
 If clearing data was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Log App/Device information
This endpoingt can be used to log relevant device/app information and usage

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/app_logs`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "os_name": string,
    "os_version": string,
    "app_version": string

}
```
* `event_date` __should__ reflect the local date and time when the request was made
* `os_name` __should__ be the os name (Android/iOS)
* `os_version` __should__ be the version of os running on the device
* `app_version` __should__ be the version of app installed


```
POST /plans/version/misc/app_logs HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-12-13T18:19:50Z",
    "os_name": Android,
    "os_version": "8.1.0",
    "app_version": "2.2.9"
}
```
##### Responses
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

#### Copy test user's data
This endpoint can used to copy test user's data to create personas to test different scenarios. Note that his endpoint is restricted to dev and test environment to specific test accounts.

##### Query String
The client __must__ submit a request to the endpoint `/plans/version/misc/copy_test_data`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object with the following schema:
```
{
    "event_date": Datetime,
    "copy_all": Boolean
}
```
* `event_date` __should__ reflect the local date and time when the request was made
* `cop_all` __should__ be true if trying to copy/reset data for all personas. Setting it false would only copy/reset data for the persona logged in.

```
POST /plans/version/misc/copy_test_data HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-13T11:12:30Z",
    "copy_all": true
}
```
##### Responses
 If copying data was successful, the Service __will__ respond with HTTP Status `202 Accepted`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```




