# Plans API

## Common provisions

#### Terminology

The terminology of [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt) (specifically __must__, __should__, __may__ and their negatives) applies.  The word __will__, when applied to the Plans API ("the API"), has the same meaning as __must__.

#### Protocol

The API supports communication over HTTPS only.

#### Encoding

The API supports communication using JSON encoding only.  The client __must__ submit the headers `Content-Type: application/json` and `Accept: application/json` for all requests.  Failure to do so __will__ result in a `415 Unsupported Media Type` response.  The API __will__ include the header `Content-Type: application/json` with its response.

#### Authentication

Unless otherwise specified, the endpoints in the API are authenticated by a JWT bearer token.  One token source are accepted:

* Tokens generated by Amazon Cognito and acquired as part of authentication to the Users Service;

The client __must__ submit the header `Authorization: <JWT>` with all requests. Failure to do so, or submitting an invalid or expired JWT, __will__ result in a `401 Unauthorized` response.  

#### General responses

In addition to the AWS API Gateway responses and the specific responses for each endpoint, the server __may__ respond with one of the following HTTP responses:

* `400 Bad Request` with `Status` header equal to `InvalidSchema`, if the JSON body of the request does not match the requirements of the endpoint.
* `404 Unknown` with `Status` header equal to `UnknownEndpoint`, if an invalid endpoint was requested.

## Schema

### Simple

The following simple types __may__ be used in responses:

* `string`, `number`: as defined in the [JSON Schema](http://json-schema.org) standard.
* `Uuid`: a `string` matching the regular expression `^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$`, that is, the string representation of an [RFC 4122](https://tools.ietf.org/html/rfc4122) UUID.
* `Datetime`: a `string` matching the regular expression `/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|+\d{2}:\d{2})/` and representing a date and time in full [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

## Endpoints

### Daily Readiness

#### Create

This endpoint can be called to register a new daily readiness survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/daily_readiness`.

##### Request

The client __must__ submit a request body containing a JSON object with the following schema:
```
{
	"date_time": Datetime,
	"user_id": Uuid,
	"soreness": [{"body_part": number, "severity": number}],
	"sleep_quality": number,
	"readines": number
}
```
* `date_time` __should__ reflect the local time that survey was taken
* `soreness` __should__ reflect the number of body part that the user indicated soreness. Length __could__ be 0.
* `body_part` __should__ be an integer between 1 and 10
* `severity` __should__ be an integer between 1 and 5
* `sleep_quality` __should__ be an integer between 1 and 10
* `readiness` __should__ be an integer between 1 and 10

```
POST /plans/daily_readiness HTTPS/1.1
Host: apis.env.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
	"date_time": "2018-07-03 10:42:20.1234",
	"user_id":"02cb7965-7921-493a-80d4-6b278c928fad",
	"soreness":[
			{"body_part": 8, "severity": 2},
			{"body_part": 14, "severity": 3}
		   ],
	"sleep_quality":4,
	"readiness":10}

```

##### Responses
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body with the following syntax:
 
```
{
    "message": "success"
}
```

### Hello

#### World

This endpoint serves as a demonstration of the service

##### Query String
 
The client __must__ submit a request to the endpoint `/hello/world`. The request method __must__ be `GET`.



```
GET /plans/hello/world HTTP/1.1
Host: apis.env.fathomai.com
Content-Type: application/json


```

Authentication is not required for this endpoint.

##### Responses
 
The Service __will__ respond with HTTP Status `200 Ok`, and with a body with the following syntax:
 
```
{
    "message": String
}
```


