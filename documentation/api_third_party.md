# FathomAI - Plans API (v 4.8.0)

## Common provisions

#### Terminology

The terminology of [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt) (specifically __must__, __should__, __may__ and their negatives) applies.  The word __will__, when applied to the Plans API ("the API"), has the same meaning as __must__.

#### Protocol

The API supports communication over HTTPS only.  Requests sent via HTTP will be redirected to HTTPS connections.

#### Encoding

The API supports communication using JSON encoding only.  The client __must__ submit the headers `Content-Type: application/json` and `Accept: application/json` for all requests.  Failure to do so __will__ result in a `415 Unsupported Media Type` response.  The API __will__ include the header `Content-Type: application/json` with its response.

#### Authentication

Unless otherwise specified, the endpoints in the API are authenticated by a JWT bearer token.  

The client __must__ submit the header `Authorization: <JWT>` with all requests. Failure to do so, or submitting an invalid or expired JWT, __will__ result in a `401 Unauthorized` response.  

Two token sources are accepted:

* Tokens generated by Amazon Cognito and acquired as part of authentication to the Users Service (Fathom Mobile App Only);
* Tokens generated by partners according to the guidelines specified below.  It is expected that partners will normally generate and sign their own JWTs for their clients, providing appropriate authorization for each athlete in accordance with their business and compliance requirements.

##### Signing keys

Prior to integrating with the API, each partner  __must__ supply a set of one or more public keys with which they will sign clients' JWT credentials.  This __must__ take the form of an [RFC 7517](https://tools.ietf.org/html/rfc7517) JSON Web Key Set document, for example:

```json
{
    "keys": [
        {
            "kid": "fathom_001",
            "alg": "RS256",
            "kty": "RSA",
            "use": "sig",
            "e": "AQAB",
            "n": "snrCqqc2tC......Z29H9DBLIQ",
            "_env": ["dev", "test"]
        },
        {
            "kid": "fathom_002",
            "alg": "RS256",
            "kty": "RSA",
            "use": "sig",
            "e": "AQAB",
            "n": "yuHDihazrP......UuEPOofbVQ",
            "_env": "production"
        }
    ]
}
```

Each key within the key set  __must__ have a `kid` field matching the regular expression `^([a-z][a-z0-9\-]{3,31})_([a-z0-9\-]+)$`, where the first group of the expression is the partner's Provider Code.  

Each key within the key set  __must__ have a `use` field set to `sig` if the key is to be used for signing JWTs.  Partners __should not__ include keys with other values in the key set.

At the present time the only algorithm from the  [RFC 7518](https://tools.ietf.org/html/rfc7518#section-3) list supported is RSA-256, so the value of the `alg` field for each key in the key set __must__ be `RS256`.  We hope to support at least `ES256` in the near future.

Partners __may__ include the non-standardized fields `_nbf` and `_exp` in key definitions; if these fields are provided, they __must__ follow the semantics of the corresponding JWT claim fields in  [RFC7519](https://tools.ietf.org/html/rfc7519#section-4.1.3), and the API __will__ interpret them similarly (that is to say, a JWT with an `iat` value falling before the corresponding key's `nbf` value or after its `exp` value, will not be considered valid).  This allows partners to perform key rotation in an orderly fashion.

Partners __may__ include the non-standardized field `_env` in key definitions; if this field is provided the value  __must__ be a String matching the regular expression `^[a-z0-9]+$` or an array of such Strings, and the API  __will__ interpret this as a list of the environments where the key should be accepted.  This allows partners to use different signing keys for production and non-production environments.

##### JWT claims

The JWTs provided by clients  __must__ contain the following claims:

* `iss`, which __must__ be a String matching the regular expression `^([a-z][a-z0-9\-]{3,31})_([a-z0-9\-]+)$`, where the first group of the expression is the partner's Provider Code.  
* `aud`, which __must__ be a String matching the regular expression `^fathom(_[a-z0-9]+)?$` (or an array containing such a String).  If the group is provided (eg `fathom_production`), the API __will__ treat the second part as an environment specifier, and __will__ only accept as valid JWTs targeted at its own environment (for instance, the production API will only accept tokens with an `aud` value of `fathom` and/or `fathom_production`).
* `iat` __must__ be specified.
* `exp` __must__ be specified.  The total period of validity of the JWT (ie the time range between the lesser of `iat` and `nfb`, and `exp`) __must not__ be greater than 86400 seconds.
* `sub`, which __must__ be a Uuid identifying the athlete on whose behalf the client is acting.  In general the API will only allow requests which correspond to actions affecting this user.
* `scope`, which __must__ be a String containing a space-separated list of Scopes, where each Scope is a String matching the regular expression `^[a-z][a-z0-9\.:]*$`.  The following scopes are recognised by the API:
   * `fathom.plans:read`: provides access to read-only functionality for the athlete identified by the `sub` claim
   * `fathom.plans:write`: provides access to write functionality for the athlete identified by the `sub` claim.  This is a superset of `fathom.plans:read`.
   * `fathom.plans:service`: provides access to all functionality for all users.  JWTs with this scope are subject to additional validation conditions described below.

##### Service tokens

Partners __may__ interact with the API on a business-to-business basis instead of, or in addition to, building clients which allow users to interact with the API directly.  Partners' private servers __may__ authenticate such requests using a JWT carrying the `fathom.plans:service` scope.  Such tokens must meet the following additional validation conditions:

* The value of the `sub` field  __must__ be the String `00000000-0000-4000-8000-000000000000`.
* The total period of validity of the JWT  __must not__ be greater than 600 seconds.


#### General responses

In addition to the AWS API Gateway responses and the specific responses for each endpoint, the server __may__ respond with one of the following HTTP responses:

* `400 Bad Request` with `Status` header equal to `InvalidSchema`, if the JSON body of the request does not match the requirements of the endpoint.
* `403 Forbidden` with `Status` header equal to `Forbidden`, if the user is not allowed to perform the requested action.
* `404 Unknown` with `Status` header equal to `UnknownEndpoint`, if an invalid endpoint was requested.

<br/>

## Schema

### Simple

The following simple types __may__ be used in requests and responses:

* `string`, `number`, `integer`, `boolean`: as defined in the [JSON Schema](http://json-schema.org) standard.
* `Uuid`: a `string` matching the regular expression `^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$`, that is, the string representation of an [RFC 4122](https://tools.ietf.org/html/rfc4122) UUID.
* `Datetime`: a `string` matching the regular expression `/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|+\d{2}:\d{2})/` and representing a date and time in full  [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

<div style="page-break-after: always;"></div>


## Endpoints

### Daily Readiness

#### Create

This endpoint can be called to register a new daily readiness survey.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/daily_readiness/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "date_time": Datetime,
    "soreness": [sore_part, sore_part],
    "sessions": [session, session],
    "sessions_planned": boolean,
    "health_sync_date": Datetime,
    "user_age": number
}
```
* `date_time` __should__ reflect the local time that survey was taken
* `soreness` __should__ reflect a list of body parts(`sore_part`) with symptoms. Length __could__ be 0.
* `sessions` is __optional__ and __should__ be a list of session objects, where each session matches the body of Create Session.
* `sessions_planned` is __optional__ and __should__ represent whether the user plans to train again that day.
* `health_sync_date` (Fathom Mobile App Only) is __optional__ and only provided if one of the sessions is obtained from a third party source
* `user_age` (Fathom Mobile App Only) is __optional__ and only needed if one of the sessions is obtained from a third party source and contains heart rate data
* `sore_part` __should__ have the following schema:
```
{
    "body_part": number,
    "side": number,
    "tight": number,
    "knots": number,
    "ache": number,
    "sharp": number
}

```
* `body_part` __should__ be an integer reflecting BodyPart enumeration as defined in Appendix
* `side` __should__ be an integer reflecting Side enumeration as defined in Appendix
* `tight` __should__ be an integer (1-10) indicating the severity of tightness felt. If not reported, it should be `null`
* `knots` __should__ be reported for muscles(see Appendix) only and __should__ be an integer (1-10) indicating the severity of discomfort caused by knots, tigger points, and musclular adhesions felt. If not reported, it should be `null`
* `ache` __should__ be an integer (1-10) indicating the severity of discomfort felt described as an ache, dull, or sore, indicating inflammation and muscle spasms are likely present. If not reported, it should be `null`
* `sharp` __should__ be an integer (1-10) indicating the severity of discomfort felt described as sharp, acute, shooting, indicating that inflammation and muscle spasms are likely present. If not reported, it should be `null`

```
POST /plans/{version}/daily_readiness/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "date_time": "2018-12-10T17:45:24Z",
    "soreness":[{
                                    "body_part": 14,
                                    "side": 2
                                    "tight": null,
                                    "knots": null,
                                    "ache": 3,
                                    "sharp": 6,
                                }],
    "sessions": [{"event_date": "2018-12-10T12:30:00Z",
                  "sport_name": 3,
                  "duration": 90,
                  "description": "Evening Practice",
                  "post_session_survey": {
                                         "event_date": "2018-12-10T17:45:24Z",
                                         "RPE": 9,
                                         "soreness": []
                                        }
                  }
                ],
    "user_age": 25,
    "sessions_planned": false
}
```
<div style="page-break-after: always;"></div>


##### Response
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body having the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan.


<div style="page-break-after: always;"></div>


### Session

#### Create

This endpoint can be called to log a new session to today's plan and should include the session's information as well as post-session surveys for the session being logged.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "sessions": [session, session],
    "health_sync_date": Datetime,
    "sessions_planned": Boolean,
    "user_age": number
}
```
* `event_date` __should__ reflect the date and time when the survey is submitted.
* `health_sync_date` (Fathom Mobile App Only) is __optional__ and only provided if one of the sessions is obtained from a third party source
* `sessions_planned` __should__ represent whether the user plans to train again that day
* `user_age` (Fathom Mobile App Only) is __optional__ and only provided if one of the sessions is obtained from a third party source and contains heart rate data
<div style="page-break-after: always;"></div>


* `session` __should__ be of the following schema
```
{
    "event_date": Datetime,
    "end_date": Datetime,
    "session_type": integer,
    "sport_name": integer,
    "duration": integer,
    "description": string,
    "calories": integer,
    "distance": integer,
    "source": integer,
    "deleted": boolean,
    "ignored": boolean,
    "post_session_survey": {
                            "event_date": Datetime
                            "RPE": integer,
                            "soreness": [sore_part, sore_part]
                        },
    "workout_program_module": workout_program_module
    "hr_data": [hr, hr, hr],
}
```
* `event_date` __should__ reflect the start time of the session (third party/FathomPRO data) or when the session is logged (manually logged session)
* `end_date` is __optional__ parameter that reflects the end time of the session for third party/FathomPRO data
* `session_type` __should__ reflect SessionType enumeration. NOTE: We'll only use 6 moving forward
* `sport_name` __should__ reflect SportName enumeration as defined in Appendix.
* `duration` __should__ be in minutes and reflect the duration which the user confirmed (third party data) or entered (manually logged session).
* `calories` __if present__, __should__ be calorie information obtained from third party workout _(only needed for third party workout)_
* `distance` __if present__, __should__ be distance information obtained from third party workout _(only needed for third party workout)_
* `source` __if present__, __should__ be SessionSource enumeration as defined in Appendix
* `deleted` __if present__, __should__ be true if the user deletes the workout detected from the third party source 
* `ignored` __if present__, __should__ be true for short walking workouts.
* `hr_data` __if present__, __should__ be the heart rate data associated with the third party workout. Each hr will have `startDate`, `endDate` and `value` _(only needed for third party workout)_
* `description` is __optional__ parameter to provide short description of the session they're adding
* `post_session_survey` __should__ follow requirements below
* `workout_program_module` __if present__ __should__ provide details about the workout and follow the requirements defined below

`post_session_survey` data elements

* `event_date` __should__ be a Datetime and reflect the local date and time when the survey (associated with the workout) was completed
* `RPE` __should__ be an integer between 1 and 10 indicating the  _Rating of Perceived Exertion_ of the athlete during the session
* `soreness` __should__ follow the same definition as in  _Daily Readiness_

`workout_program_module` data elements

* `provider_id` __should__ be an unique identifier for the partner
* `program_id` __should__ be an identifier of the workout program
* `program_module_id` __should__ be an identifier for the specific program module
* `workout_sections` __should__ be a list of individual _workout_section_ elements contained within the module

`workout_section` data elements

* `name` __should__ be an identifying section name
* `duration_seconds` __should__ be total time assigned or taken to complete the section
* `difficulty` __should__ be the difficulty rating for the section
* `intensity_pace` __should__ be the intensity rating for the section
* `exercises` __should__ be a list of of all _exercise_ elements assigned within the section

`exercise` data elements

* `id` __should__ be provider's unique identifier for the exercise
* `name` __should__ be the exercise name
* `weight_measure` __should__ be the unit external weight used is measured in either (weight in lbs, percent bodyweight or rep max)
* `weight` __should__ represent the numeric value of the weight used according to the `weight_measure` attribute
* `bilateral` __should__ be a boolean representation of whether exercise is performed on both sides
* `side` __should__ represent the side (left or right) on which the exercise is performed if `bilateral` is false
* `sets` __should__ be an integer representation of total sets of the exercise to be performed
* `reps_per_set` __should__ be an integer representing of total reps of exercise to be performed per set
* `unit_of_measure` __should__ be an enum representation of the unit the reps are measured in
* `intensity_pace` __should__
* `movement_id` __if present__, __should__ be an unique identifier for underlying movement associated with the exercise
* `rpe` __should__ be an integer between 1 and 10 indicating the  _Rating of Perceived Exertion_ of the athlete during the exercise

<div style="page-break-after: always;"></div>

```
POST /plans/{version}/session/{User UUID} HTTP/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache
{
    "event_date": "2019-01-12T16:54:57Z",
    "sessions":[
                {
                    "event_date": "2019-01-12T10:41:57Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 14,
                    "description": "Evening Practice",
                    "calories": 100,
                    "distance": 200,
                    "end_date": "2019-02-12T10:54:57Z",
                    "source": 1,
                    "deleted": false,
                    "ignored": false,
                    "hr_data":  [
                                {"value": 153,
                                 "startDate": "2019-01-12T10:43:08.490-0500",
                                 "endDate": "2019-01-12T10:43:08.490-0500"
                                 },
                            ],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:54:57Z",
                                            "RPE": 5,
                                            "soreness": [],
                                            "clear_candidates": []
                                            },
                    "workout_program_module": {
                                            "provider_id": "test_id",
                                            "program_id": "23G",
                                            "program_module_id": "56",
                                            "workout_sections": [{
                                                "name": "Upper Body Work",
                                                "duration_seconds": 360,
                                                "workout_section_type": "1",
                                                "difficulty": 5,
                                                "intensity_pace": 5,
                                                "exercises": [
                                                    {
                                                        "id": "1",
                                                        "name": "Bent over Row",
                                                        "weight_measure": 2,
```
```
                                                        "weight_in_lbs": 150,
                                                        "rep_max": null,
                                                        "percent_bodyweight": null,
                                                        "sets": 2,
                                                        "reps_per_set": 10,
                                                        "unit_of_measure": 1,
                                                        "intensity_pace": 5,
                                                        "movement_id": "",
                                                        "bilateral": true,
                                                        "side": 0,
                                                        "rpe": 5
                                                    }
                                                    ]
                                            }]
                                        }
                    }
                    
                ],
    "sessions_planned": true,
    "health_sync_date": "2019-02-08T16:54:57Z"
}
```

##### Response
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body having the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan.


<div style="page-break-after: always;"></div>


#### Mark no sessions planned

This endpoint can be called to notify that no sessions are planned for the day.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}/no_sessions`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime
}
```
* `event_date` __should__ reflect the date and time when the call is made

```
POST /plans/{version}/session/{User UUID}/no_sessions HTTP/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJ0eX...xA8
Cache-Control: no-cache

{
    "event_date": "2018-09-14T19:54:48Z"

}
```
##### Response
 
 If the request was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan.

<div style="page-break-after: always;"></div>


#### Delete

This endpoint can be called to delete existing externally regimented session from today or yesterday's plan.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}/{session_id}`. The request method __must__ be `DELETE`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "session_type": integer
}
```
* `event_date` __should__ reflect the date and time the session was scheduled for.
* `session_type` __should__ reflect SessionType enumeration.

```
DELETE /plans/{version}/session/{User UUID}/{Session ID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-08-10T16:30:00Z",
    "session_type": 6
}
```
##### Response
 
 If the delete was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "message": "success"
}
```

<div style="page-break-after: always;"></div>


#### Update

This endpoint can be called to update a session that was previously logged/planned

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}/{session_id}`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "return_updated_plan": boolean,
    "user_age": integer
    "sessions": [session],
}
```
* `event_date` __should__ reflect the local date and time when the call is being made
* `return_updated_plan` __should__ reflect whether an updated plan is expected
* `user_age` __should__ reflect the user's age
* `session` __should__ follow the same schema as defined in Create Session
* `health_sync_date` (Fathom Mobile App only) __should__ reflect the time when the data was obtained from the third party source

```
PATCH /plans/{version}/session/{User UUID}/{Session ID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-02-08T16:30:00Z",
    "sessions": [
                 {
                    "event_date": "2019-02-08T16:45:55Z",
                    "end_date": "2019-02-08T16:45:55Z",
                    "session_type": 6,
                    "sport_name": 1,
                    "duration": 90.5,
                    "calories": 50,
                    "distance": 100,
                    "source": 1,
                    "hr_data": [],
                    "post_session_survey": {
                                            "event_date": "2019-02-08T16:30:00Z",
                                            "RPE": null,
                                            "soreness": [],
                                            "clear_candidates": []
                                            }

                }
                ],
    "health_sync_date": "2019-02-08T16:30:00Z"
}
```
##### Response
 
 If the update was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "message": "success"
}
```

<div style="page-break-after: always;"></div>


#### Typical Sessions history

This endpoint can be called to get typical sessions that the user logs

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/session/{User UUID}/typical`. The request method __must__ be `POST`.

##### Request
For `POST` method, the client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime
}
```
```
POST /plans/{version}/session/{User UUID}/typical HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-02-08T16:30:00Z"
}

```
Authentication is required for this endpoint

##### Response
 
 The Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "typical_sessions": [sesson, session]
}
```
* `typical sessions` will be a list of sessions that the user has logged in the last 14 days
<div style="page-break-after: always;"></div>


* `session` object will be of the following schema

``` 
{
    "count": integer,
    "duration": integer,
    "event_date": datetime,
    "session_type": integer,
    "sport_name": integer,
    "strength_and_conditioning_type": integer
}

```

<div style="page-break-after: always;"></div>


### Symptoms

#### Submit

This endpoint can be called to submit symptoms to receive a new plan without submitting a session.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/version/symptoms/{User UUID}`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "soreness": [sore_part, sore_part]
}
```
* `event_date` __should__  be a Datetime and reflect the local time that survey was taken
* `soreness` __should__ reflect a list of body parts(`sore_part`) as defined in Readiness Create


```
POST /plans/version/symptoms/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2019-10-29T17:45:24Z",
    "soreness":[
        {
            "body_part": 18,
            "side": 0,
            "tight": 4,
            "knots": null,
            "sharp": null,
            "ache": null
        }
    ]
}
```
<div style="page-break-after: always;"></div>


##### Response
 
 If the write was successful, the Service __will__ respond with HTTP Status `201 Created`, with a body having the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan.


<div style="page-break-after: always;"></div>


### Active Recovery

#### Mark Started (Exercise Modalities)

This endpoint can be called to mark the start of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/active_recovery/{User UUID}/exercise_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": integer
}
```
* `event_date` __should__ be the time when user checks the first exercise for the session.
* `recovery_type` __should__ be an integer reflecting Recovery Types enumeration as defined in Appendix.

```
POST /plans/{version}/active_recovery/{User UUID}/exercise_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": 0
}
```
##### Response
 
If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "message": "success"
}
```

<div style="page-break-after: always;"></div>


#### Mark Completed (Exercise Modalities)

This endpoint can be called to mark the completion of exercise-based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/active_recovery/{User UUID}/exercise_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": integer
    "completed_exercises": [string]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be an integer reflecting Recovery Types enumeration as defined in Appendix.
* `completed_exercises` __should__ be a list representing the exercises that the user checked off

```
PATCH /plans/{version}/active_recovery/{User UUID}/exercise_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": 1,
    "completed_exercises": ["3", "5", "20", "142"]
}
```
##### Response
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body having the following schema:
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan.



<!-- #### Mark Started (Body Part Modalities)

This endpoint can be called to mark the start of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/active_recovery/{User UUID}/body_part_modalities`. The request method __must__ be `POST`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
}
```
* `event_date` __should__ be the time when user checks the starts the session
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`

```
POST /plans/{version}/active_recovery/{User UUID}/body_part_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "heat"
}
```
##### Response
 
If the write was successful, the Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "message": "success"
}
```

#### Mark Completed (Body Part Modalities)

This endpoint can be called to mark the completion of body part based modalities.

##### Query String
 
The client __must__ submit a request to the endpoint `/plans/{version}/active_recovery/{User UUID}/body_part_modalities`. The request method __must__ be `PATCH`.

##### Request

The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime,
    "recovery_type": string
    "completed_body_parts": [body_part]
}
```
* `event_date` __should__ be the time when user completes the session.
* `recovery_type` __should__ be one of `heat`, `ice` or `cold_water_immersion`
* `completed_body_parts` __should__ be a list representing the body parts that the user selected from the provided list. It should be empty for `cold_water_immersion`.
* `body_part` __should__ be of the following schema.
```
{
    "body_part_location": number,
    "side": number
}
```
* `body_part_location` __should__ be an integer reflecting Body Part enumeration as defined in Appendix
* `side` __should__ be an integer reflecting [side](#side) enumeration

```
PATCH /plans/version/active_recovery/{User UUID}/body_part_modalities HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ
{
    "event_date": "2018-09-21T17:53:39Z",
    "recovery_type": "ice",
    "completed_body_parts": [
                                {
                                    "body_part_lcoation": 3,
                                    "side": 0,
                                },
                                {
                                    "body_part_lcoation": 7,
                                    "side": 1,
                                }
                        ]
}
```
##### Response
 
 If the write was successful, the Service __will__ respond with HTTP Status `202 Accepted`, and return the daily_plan in the body with following schema.
 
```
{
    "daily_plans": [daily_plan]
}
```
* `daily_plan` will have the same schema as defined in Get Daily Plan. -->


<div style="page-break-after: always;"></div>


### Daily Plan

#### Get Daily Plan

##### Query String
The client __must__ submit a request to the endpoint `/plans/{version}/daily_plan/{User UUID}`. The request method __must__ be `POST`.

##### Request
The client __must__ submit a request body containing a JSON object having the following schema:
```
{
    "event_date": Datetime
    "start_date": string,
    "end_date": string
}
```
* `event_date` __should__ reflect the time (in local timezone) when the api call is made.
* `start_date` __should__ be of format `yyyy-mm-dd`
* `end_date` __should__ be of format `yyyy-mm-dd` but is __optional__

```
POST /plans/{version}/daily_plan/{User UUID} HTTPS/1.1
Host: apis.{env}.fathomai.com
Content-Type: application/json
Authorization: eyJraWQ...ajBc4VQ

{
    "event_date": "2018-07-31T02:50:02Z",
    "start_date": "2018-07-31"
}
```
<div style="page-break-after: always;"></div>


##### Response
 
The Service __will__ respond with HTTP Status `200 OK`, with a body having the following schema:
 
```
{
    "daily_plans": [daily_plan1, daily_plan2],
    "readiness": readiness,
    "typical_sessions": [session, session]
}
```
* `readiness` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined in Daily Readiness
* `typical_sessions` is only returned if readiness survey hasn't been completed for the day and will follow the schema defined in Session
* `daily_plans` __could__ be an empty list
* each `daily_plan*` will be of following schema:
<!-- ```
{
    "date": Date,
    "day_of_week": integer,
    "pre_active_rest": [PreActiveRest],
    "completed_pre_active_rest": [PreActiveRest],
    "heat": Heat,
    "completed_heat": [Heat],
    "warm_up": [WarmUp],
    "completed_warm_up": [WarmUp],
    "training_sessions": [Session],
    "cool_down": [CoolDown],
    "completed_cool_down": [CoolDown],
    "post_active_rest": [PostActiveRest],
    "completed_post_active_rest": [PostActiveRest],
    "ice": Ice,
    "completed_ice": [Ice],
    "cold_water_immersion": ColdWaterImmersion,
    "completed_cold_water_immersion": [ColdWaterImmersion],
    "cross_training_sessions": [],
    "daily_readiness_survey_completed": Boolean,
    "landing_screen": integer,
    "last_sensor_sync": Datetime,
    "last_updated": Datetime,
    "nav_bar_indicator": null,
    "post_active_rest_completed": Boolean,
    "pre_active_rest_completed": Boolean,
    "sessions_planned": Boolean,
    "train_later": Bolean
}
``` -->
```
{
    "date": Date,
    "day_of_week": integer,
    "modalities": [modality],
    "completed_modalities": [modality],
    "modalities_available_on_demand": [modality_display]
    "pre_active_rest": [],
    "completed_pre_active_rest": [],
    "heat": null,
    "completed_heat": [],
    "warm_up": [],
    "completed_warm_up": [],
    "training_sessions": [Session],
    "cool_down": [],
    "completed_cool_down": [],
    "post_active_rest": [],
    "completed_post_active_rest": [],
    "ice": null,
    "completed_ice": [],
    "cold_water_immersion": null,
    "completed_cold_water_immersion": [],
    "cross_training_sessions": [],
    "daily_readiness_survey_completed": Boolean,
    "landing_screen": integer,
    "last_sensor_sync": Datetime,
    "last_updated": Datetime,
    "nav_bar_indicator": null,
    "post_active_rest_completed": Boolean,
    "pre_active_rest_completed": Boolean,
    "sessions_planned": Boolean,
    "train_later": Bolean
}
```
<div style="page-break-after: always;"></div>


* Any of the `completed_*` attributes could be empty list
<!--* Any of the exercise modalities (`pre_active_rest`, `post_active_rest`, `warm_up` and `cool_down`) could be empty list
* `warm_up` and `cool_down` will always be empty list-->
* All of the body part modalities (`heat`, `ice`, `cold_water_immersion`) will be null
<!-- * Any of the body part modalities (`heat`, `ice`, `cold_water_immersion`) could be null -->
<!-- * `Heat` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "before_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
```
* `Ice` has following example schema
```
{
    "active": true,
    "body_parts": [
        {
            "active": true,
            "after_training": true,
            "body_part_location": 7,
            "completed": false,
            "goals": [
                {
                    "goal_type": 0,
                    "priority": 1,
                    "text": "Care for Pain",
                    "trigger": "Pain Reported Today"
                }
            ],
            "immediately_after_training": false,
            "repeat_every_3hrs_for_24hrs": false,
            "side": 1
        }
    ],
    "completed": false,
    "completed_date_time": null,
    "event_date_time": null,
    "minutes": 10,
    "start_date_time": null
}
``` -->
<!-- * `ColdWaterImmersion` has following example schema
```
{
    "minutes": 10,
    "after_training"': true,
    "goals": [
        {
            "goal_type": 0,
            "priority": 1,
            "text": "Care for Pain",
            "trigger": "Pain Reported Today"
        }
    ],
    "start_date_time": null,
    "completed_date_time": null,
    "event_date_time": null,
    "completed": false,
    "active": true
}

``` -->
<!--
* `PreActiveRest` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "active_stretch_exercises": [AssignedExercise, AssignedExercise]
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
    "muscular_strain_increasing": false,
    "start_date_time": null,
}
```
* `PostActiveRest` has following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "default_plan": "Complete",
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "inhibit_exercises": [AssignedExercise, AssignedExercise],
    "isolated_activate_exercises": [AssignedExercise, AssignedExercise],
    "muscular_strain_increasing": false,
    "start_date_time": null,
    "static_integrate_exercises": [AssignedExercise, AssignedExercise],
    "static_stretch_exercises": [AssignedExercise, AssignedExercise]
}
```
-->
<!-- * `CoolDown` has the following example schema
```
{
    "active": true,
    "completed": false,
    "completed_date_time": null,
    "dynamic_integrate_exercises": [AssignedExercise, AssignedExercise],
    "dynamic_stretch_exercises": [AssignedExercise, AssignedExercise],
    "event_date_time": "2019-05-07T00:00:00Z",
    "high_relative_intensity_logged": false,
    "high_relative_load_session": true,
    "muscular_strain_increasing": false,
    "sport_name": 17,
    "start_date_time": null
    }
``` -->
* `modality` has the following example schema:

```
{
    "id" : "ef1db466-4ccf-45cf-980a-2632a600e3ee",
    "type" : 0,
    "title" : "MOBILIZE",
    "when" : "before training",
    "when_card" : "before training",
    "start_date_time" : null,
    "completed_date_time" : null,
    "event_date_time" : "2020-01-03T09:32:14Z",
    "completed" : false,
    "active" : false,
    "default_plan" : "Complete",
    "force_data" : false,
    "goal_title" : "",
    "display_image" : "inhibit",
    "locked_text" : "Sorry, you missed the optimal window for Mobilize today.",
    "goals" : {
        "Recover from training" : {
            "efficient_active" : true,
            "complete_active" : true,
            "comprehensive_active" : true
        },
        "Care for symptoms" : {
            "efficient_active" : false,
            "complete_active" : true,
            "comprehensive_active" : true
        }
    },
    "exercise_phases" : [ExercisePhase, ExercisePhase]
}
```
* `type` __should__ be an integer reflecting Recovery Types enumeration as defined in Appendix
* `ExercisePhase` has the following example schema:

```
{
    "type" : 0,
    "name" : "inhibit",
    "title" : "FOAM ROLL",
    "exercises" : [AssignedExercise, AssignedExercise]
}
```
* `type` __should__ be an integer reflecting Exercise Phase Type enumeration as defined in Appendix
<div style="page-break-after: always;"></div>


* `AssignedExercise` has the following example schema

```
{
    "name" : "Foam Roller - Hamstrings",
    "display_name" : "Foam Roll - Hamstrings",
    "library_id" : "3",
    "description" : "Place foam roller just before the glute & roll the length of 
                     your hamstring. If you find a tender spot, hold for 30 seconds.
                     Donâ€™t have a foam roller?
                     You can use a tennis ball or water bottle.",
    "youtube_id" : null,
    "bilateral" : true,
    "seconds_per_rep" : null,
    "seconds_per_set" : 30,
    "unit_of_measure" : "seconds",
    "position_order" : 0,
    "duration_efficient" : 60,
    "duration_complete" : 60,
    "duration_comprehensive" : 60,
    "goal_text" : "",
    "equipment_required" : [ 
        "Foam Roller"
    ],
    "dosages" : [ 
        {
            "goal" : {
                "text" : "Soreness",
                "priority" : 1,
                "goal_type" : 1
            },
            "priority" : "1",
            "efficient_reps_assigned" : 30,
            "efficient_sets_assigned" : 1,
            "complete_reps_assigned" : 30,
            "complete_sets_assigned" : 1,
            "comprehensive_reps_assigned" : 30,
            "comprehensive_sets_assigned" : 1,
            "default_efficient_reps_assigned" : 30,
            "default_efficient_sets_assigned" : 1,
            "default_complete_reps_assigned" : 30,
            "default_complete_sets_assigned" : 1,
            "default_comprehensive_reps_assigned" : 30,
            "default_comprehensive_sets_assigned" : 1,
            "ranking" : 0
        }
    ]
}
```

<div style="page-break-after: always;"></div>


## Appendix

### Enumerations
#### BodyPart

```
    chest = 2
    abdominals = 3
    groin = 5
    quads = 6
    knee = 7
    shin = 8
    ankle = 9
    foot = 10
    it_band = 11
    lower_back = 12
    glutes = 14
    hamstrings = 15
    calves = 16
    achilles = 17
    upper_back_neck = 18
    elbow = 19
    wrist = 20
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    it_band_lateral_knee = 27
    hip_flexor = 28
    deltoid = 29
```
#### Side

```
    none_unilateral = 0
    left = 1
    right = 2
```

#### SessionSource
``` 
    user = 0
    health = 1
    user_health = 2
    three_sensor = 3
```
<div style="page-break-after: always;"></div>


#### Recovery Types
``` 
    pre_active_rest = 0
    post_active_rest = 1
    warm_up = 2
    cool_down = 3
    functional_strength = 4
```

#### Exercise Phase Type
```
    inhibit = 0
    static_stretch = 1
    active_stretch = 2
    dynamic_stretch = 3
    isolated_activate = 4
    static_integrate = 5
```

<div style="page-break-after: always;"></div>


#### All body parts

```
    shoulder = 1
    chest = 2
    abdominals = 3
    hip = 4
    groin = 5
    quads = 6
    knee = 7
    shin = 8
    ankle = 9
    foot = 10
    it_band = 11
    lower_back = 12
    general = 13
    glutes = 14
    hamstrings = 15
    calves = 16
    achilles = 17
    upper_back_neck = 18
    elbow = 19
    wrist = 20
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    core_stabilizers = 25
    erector_spinae = 26
    it_band_lateral_knee = 27
    hip_flexor = 28
    deltoid = 29
    deep_rotators_hip = 30
    obliques = 31
    anterior_tibialis = 40
    peroneals_longus = 41
    posterior_tibialis = 42
    soleus = 43
    gastrocnemius_medial = 44
    bicep_femoris_long_head = 45
    bicep_femoris_short_head = 46
    semimembranosus = 47
    semitendinosus = 48
    adductor_longus = 49
    adductor_magnus_anterior_fibers = 50
    adductor_magnus_posterior_fibers = 51
    adductor_brevis = 52
    gracilis = 53
    pectineus = 54
```
```
    vastus_lateralis = 55
    vastus_medialis = 56
    vastus_intermedius = 57
    rectus_femoris = 58
    tensor_fascia_latae = 59 # hips
    piriformis = 60 # deep rotator of hip
    gastrocnemius_lateral = 61
    sartorius = 62 
    gluteus_medius_anterior_fibers = 63
    gluteus_medius_posterior_fibers = 64
    gluteus_minimus = 65
    gluteus_maximus = 66
    quadratus_femoris = 67
    popliteus = 68
    external_obliques = 69
    quadratus_lumorum = 70
    psoas = 71
    iliacus = 72
    transverse_abdominis = 73
    internal_obliques = 74
    rectus_abdominis = 75
    upper_trapezius = 76
    levator_scapulae = 77
    middle_trapezius = 78
    lower_trapezius = 79
    rhomboids = 80
    pectoralis_minor = 81
    pectoralis_major = 82
    anterior_deltoid = 83
    medial_deltoid = 84
    posterior_deltoid = 85
    upper_body = 91
    lower_body = 92
    full_body = 93
    semimembranosus_semitendinosus = 100
    anterior_adductors = 101
    rectus_femoris_vastus_intermedius = 102
    glute_med = 103
    upper_traps_levator_scapulae = 105
    middle_traps_rhomboids = 106
    pec_major_minor = 107
    hip_flexor_merge = 108
```

<div style="page-break-after: always;"></div>


#### SportName
```
    basketball = 0
    baseball = 1
    softball = 2
    cycling = 3
    field_hockey = 4
    football = 5
    general_fitness = 6
    golf = 7
    gymnastics = 8
    skate_sports = 9
    lacrosse = 10
    rowing = 11
    rugby = 12
    diving = 13
    soccer = 14
    pool_sports = 15
    tennis = 16
    distance_running = 17
    sprints = 18
    jumps = 19
    throws = 20
    volleyball = 21
    wrestling = 22
    weightlifting = 23
    track_field = 24
    archery = 25
    australian_football = 26
    badminton = 27
    bowling = 28
    boxing = 29
    cricket = 30
    curling = 31
    dance = 32
    equestrian_sports = 33
    fencing = 34
    fishing = 35
    handball = 36
    hockey = 37
    martial_arts = 38
    paddle_sports = 39
    racquetball = 40
    sailing = 41
    snow_sports = 42
    squash = 43
    surfing_sports = 44
```
```
    swimming = 45
    table_tennis = 46
    water_polo = 47
    cross_country_skiing = 48
    downhill_skiing = 49
    kick_boxing = 50
    snowboarding = 51
    endurance = 52
    power = 53
    speed_agility = 54
    strength = 55
    cross_training = 56
    elliptical = 57
    functional_strength_training = 58
    hiking = 59
    hunting = 60
    mind_and_body = 61
    play = 62
    preparation_and_recovery = 63
    stair_climbing = 64
    traditional_strength_training = 65
    walking = 66
    water_fitness = 67
    yoga = 68
    barre = 69
    core_training = 70
    flexibility = 71
    high_intensity_interval_training = 72
    jump_rope = 73
    pilates = 74
    stairs = 75
    step_training = 76
    wheelchair_walk_pace = 77
    wheelchair_run_pace = 78
    taichi = 79
    mixed_cardio = 80
    hand_cycling = 81
    climbing = 82
    other = 83
```

<div style="page-break-after: always;"></div>


### Body Part Types

#### Joints
The following reportable body parts are considered joints
```
    elbow = 19
    wrist = 20
    knee = 7
    ankle = 9
    foot = 10
```
#### Ligaments
The following reportable body parts are considered ligaments
```
    it_band = 11
    it_band_lateral_knee = 27
    achilles = 17
```

#### Muscles
The following reportable body parts are considered muscles
```
    chest = 2
    abdominals = 3
    groin = 5
    quads = 6
    shin = 8
    lower_back = 12
    glutes = 14
    hamstrings = 15
    calves = 16
    upper_back_neck = 18
    lats = 21
    biceps = 22
    triceps = 23
    forearm = 24
    hip_flexor = 28
    deltoid = 29
```
###### Last Modified: February 20, 2020

